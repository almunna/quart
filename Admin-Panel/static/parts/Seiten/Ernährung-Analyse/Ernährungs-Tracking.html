<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<title>{{ WhiteLabel['Bezeichnung'] }} | Tracking → Ernährung & Analyse</title>
	<!--favicon-->
	<link rel="icon" href="https://cdn.personalpeak360.de/white-label/{{ WhiteLabel['Favicon'] }}" type="image/png">
	<!--plugins-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flipdown/dist/flipdown.min.css">
	<!--Data Tables -->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<!--plugins-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/fullcalendar/css/main.min.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
	<!-- loader-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/css/pace.min.css" rel="stylesheet" />
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/pace.min.js"></script>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&family=Roboto&display=swap" />
	<!-- Icons CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/icons.css" />
	<!-- App CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/app.css" />
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/dark-sidebar.css" />
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/dark-theme.css" />

	<script src="https://cdn.personalpeak360.de/assets/custom/benachrichtigung/benachrichtigung.js"></script>
    <script>
        var nachricht_func = function () { "use strict"; var e, o = function () { return (o = Object.assign || function (t) { for (var i, e = 1, n = arguments.length; e < n; e++)for (var o in i = arguments[e]) Object.prototype.hasOwnProperty.call(i, o) && (t[o] = i[o]); return t }).apply(this, arguments) }, n = (t.prototype.on = function (t, i) { var e = this.listeners[t] || []; this.listeners[t] = e.concat([i]) }, t.prototype.triggerEvent = function (t, i) { var e = this; (this.listeners[t] || []).forEach(function (t) { return t({ target: e, event: i }) }) }, t); function t(t) { this.options = t, this.listeners = {} } (i = e = e || {})[i.Add = 0] = "Add", i[i.Remove = 1] = "Remove"; var f, i, s = (a.prototype.push = function (t) { this.notifications.push(t), this.updateFn(t, e.Add, this.notifications) }, a.prototype.splice = function (t, i) { i = this.notifications.splice(t, i)[0]; return this.updateFn(i, e.Remove, this.notifications), i }, a.prototype.indexOf = function (t) { return this.notifications.indexOf(t) }, a.prototype.onUpdate = function (t) { this.updateFn = t }, a); function a() { this.notifications = [] } (i = f = f || {}).Dismiss = "dismiss"; var r = { types: [{ type: "success", className: "notyf__toast--success", backgroundColor: "#3dc763", icon: { className: "notyf__icon--success", tagName: "i" } }, { type: "error", className: "notyf__toast--error", backgroundColor: "#ed3d3d", icon: { className: "notyf__icon--error", tagName: "i" } }], duration: 2e3, ripple: !0, position: { x: "right", y: "bottom" }, dismissible: !(i.Click = "click") }, c = (p.prototype.on = function (t, i) { var e; this.events = o(o({}, this.events), ((e = {})[t] = i, e)) }, p.prototype.update = function (t, i) { i === e.Add ? this.addNotification(t) : i === e.Remove && this.removeNotification(t) }, p.prototype.removeNotification = function (t) { var i, e, n = this, t = this._popRenderedNotification(t); t && ((e = t.node).classList.add("notyf__toast--disappear"), e.addEventListener(this.animationEndEventName, i = function (t) { t.target === e && (e.removeEventListener(n.animationEndEventName, i), n.container.removeChild(e)) })) }, p.prototype.addNotification = function (t) { var i = this._renderNotification(t); this.notifications.push({ notification: t, node: i }), this._announce(t.options.message || "Notification") }, p.prototype._renderNotification = function (t) { var i = this._buildNotificationCard(t), e = t.options.className; return e && (t = i.classList).add.apply(t, e.split(" ")), this.container.appendChild(i), i }, p.prototype._popRenderedNotification = function (t) { for (var i = -1, e = 0; e < this.notifications.length && i < 0; e++)this.notifications[e].notification === t && (i = e); if (-1 !== i) return this.notifications.splice(i, 1)[0] }, p.prototype.getXPosition = function (t) { return (null === (t = null == t ? void 0 : t.position) || void 0 === t ? void 0 : t.x) || "right" }, p.prototype.getYPosition = function (t) { return (null === (t = null == t ? void 0 : t.position) || void 0 === t ? void 0 : t.y) || "bottom" }, p.prototype.adjustContainerAlignment = function (t) { var i = this.X_POSITION_FLEX_MAP[this.getXPosition(t)], e = this.Y_POSITION_FLEX_MAP[this.getYPosition(t)], t = this.container.style; t.setProperty("justify-content", e), t.setProperty("align-items", i) }, p.prototype._buildNotificationCard = function (n) { var o = this, t = n.options, i = t.icon; this.adjustContainerAlignment(t); var e = this._createHTMLElement({ tagName: "div", className: "notyf__toast" }), s = this._createHTMLElement({ tagName: "div", className: "notyf__ripple" }), a = this._createHTMLElement({ tagName: "div", className: "notyf__wrapper" }), r = this._createHTMLElement({ tagName: "div", className: "notyf__message" }); r.innerHTML = t.message || ""; var c, p, d, l, u = t.background || t.backgroundColor; i && (c = this._createHTMLElement({ tagName: "div", className: "notyf__icon" }), ("string" == typeof i || i instanceof String) && (c.innerHTML = new String(i).valueOf()), "object" == typeof i && (p = i.tagName, d = i.className, l = i.text, i = void 0 === (i = i.color) ? u : i, l = this._createHTMLElement({ tagName: void 0 === p ? "i" : p, className: d, text: l }), i && (l.style.color = i), c.appendChild(l)), a.appendChild(c)), a.appendChild(r), e.appendChild(a), u && (t.ripple ? (s.style.background = u, e.appendChild(s)) : e.style.background = u), t.dismissible && (s = this._createHTMLElement({ tagName: "div", className: "notyf__dismiss" }), u = this._createHTMLElement({ tagName: "button", className: "notyf__dismiss-btn" }), s.appendChild(u), a.appendChild(s), e.classList.add("notyf__toast--dismissible"), u.addEventListener("click", function (t) { var i, e; null !== (e = (i = o.events)[f.Dismiss]) && void 0 !== e && e.call(i, { target: n, event: t }), t.stopPropagation() })), e.addEventListener("click", function (t) { var i, e; return null === (e = (i = o.events)[f.Click]) || void 0 === e ? void 0 : e.call(i, { target: n, event: t }) }); t = "top" === this.getYPosition(t) ? "upper" : "lower"; return e.classList.add("notyf__toast--" + t), e }, p.prototype._createHTMLElement = function (t) { var i = t.tagName, e = t.className, t = t.text, i = document.createElement(i); return e && (i.className = e), i.textContent = t || null, i }, p.prototype._createA11yContainer = function () { var t = this._createHTMLElement({ tagName: "div", className: "notyf-announcer" }); t.setAttribute("aria-atomic", "true"), t.setAttribute("aria-live", "polite"), t.style.border = "0", t.style.clip = "rect(0 0 0 0)", t.style.height = "1px", t.style.margin = "-1px", t.style.overflow = "hidden", t.style.padding = "0", t.style.position = "absolute", t.style.width = "1px", t.style.outline = "0", document.body.appendChild(t), this.a11yContainer = t }, p.prototype._announce = function (t) { var i = this; this.a11yContainer.textContent = "", setTimeout(function () { i.a11yContainer.textContent = t }, 100) }, p.prototype._getAnimationEndEventName = function () { var t, i = document.createElement("_fake"), e = { MozTransition: "animationend", OTransition: "oAnimationEnd", WebkitTransition: "webkitAnimationEnd", transition: "animationend" }; for (t in e) if (void 0 !== i.style[t]) return e[t]; return "animationend" }, p); function p() { this.notifications = [], this.events = {}, this.X_POSITION_FLEX_MAP = { left: "flex-start", center: "center", right: "flex-end" }, this.Y_POSITION_FLEX_MAP = { top: "flex-start", center: "center", bottom: "flex-end" }; var t = document.createDocumentFragment(), i = this._createHTMLElement({ tagName: "div", className: "notyf" }); t.appendChild(i), document.body.appendChild(t), this.container = i, this.animationEndEventName = this._getAnimationEndEventName(), this._createA11yContainer() } function d(t) { var e = this; this.dismiss = this._removeNotification, this.notifications = new s, this.view = new c; var i = this.registerTypes(t); this.options = o(o({}, r), t), this.options.types = i, this.notifications.onUpdate(function (t, i) { return e.view.update(t, i) }), this.view.on(f.Dismiss, function (t) { var i = t.target, t = t.event; e._removeNotification(i), i.triggerEvent(f.Dismiss, t) }), this.view.on(f.Click, function (t) { var i = t.target, t = t.event; return i.triggerEvent(f.Click, t) }) } return d.prototype.error = function (t) { t = this.normalizeOptions("error", t); return this.open(t) }, d.prototype.success = function (t) { t = this.normalizeOptions("success", t); return this.open(t) }, d.prototype.open = function (i) { var t = this.options.types.find(function (t) { return t.type === i.type }) || {}, t = o(o({}, t), i); this.assignProps(["ripple", "position", "dismissible"], t); t = new n(t); return this._pushNotification(t), t }, d.prototype.dismissAll = function () { for (; this.notifications.splice(0, 1);); }, d.prototype.assignProps = function (t, i) { var e = this; t.forEach(function (t) { i[t] = (null == i[t] ? e.options : i)[t] }) }, d.prototype._pushNotification = function (t) { var i = this; this.notifications.push(t); var e = (void 0 !== t.options.duration ? t : this).options.duration; e && setTimeout(function () { return i._removeNotification(t) }, e) }, d.prototype._removeNotification = function (t) { t = this.notifications.indexOf(t); -1 !== t && this.notifications.splice(t, 1) }, d.prototype.normalizeOptions = function (t, i) { t = { type: t }; return "string" == typeof i ? t.message = i : "object" == typeof i && (t = o(o({}, t), i)), t }, d.prototype.registerTypes = function (t) { var i = (t && t.types || []).slice(); return r.types.map(function (e) { var n = -1; i.forEach(function (t, i) { t.type === e.type && (n = i) }); var t = -1 !== n ? i.splice(n, 1)[0] : {}; return o(o({}, e), t) }).concat(i) }, d }();
    </script>
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/assets/custom/benachrichtigung/benachrichtigung.css">
	<script src="https://cdn.personalpeak360.de/assets/vendor/js/vue.js"></script>
</head>

<body>
	<!-- wrapper -->
	<div class="wrapper">
		<!--sidebar-wrapper-->
		{{ sidebar | safe }}
		<!--end sidebar-wrapper-->
		
		{{ header | safe }}


		<!--page-wrapper-->
        <div class="page-wrapper">
            <!--page-content-wrapper-->
            <div class="page-content-wrapper">
                <div class="page-content">
                    <!-- Modal: ASSISTENT ZUR BESTIMMUNG DES AKTIVITÄTS-LEVELS -->
                    <div class="modal fade" id="aktivitaetsLevelModal" tabindex="-1" aria-labelledby="aktivitaetsLevelModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="aktivitaetsLevelModalLabel">Aktivitäts-Level bestimmen</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
                                </div>
                                <div class="modal-body">
                                    <!-- Schritt 1: Job-Auswahl -->
                                    <div id="step1">
                                        <p>Bitte wähle deinen Beruf oder wähle aus, dass dein Beruf nicht aufgelistet ist:</p>
                                        <select class="form-select" id="jobSelect">
                                            <option value="">Bitte wählen...</option>
                                            <optgroup label="Sitzend (geringe Aktivität)">
                                                <option value="Sitzend">Büroangestellte*r</option>
                                                <option value="Sitzend">Buchhalter*in</option>
                                                <option value="Sitzend">Grafikdesigner*in</option>
                                            </optgroup>
                                            <optgroup label="Stehend (leichte Tätigkeit)">
                                                <option value="Stehend">Verkäufer*in</option>
                                                <option value="Stehend">Kassierer*in</option>
                                                <option value="Stehend">Lehrer*in</option>
                                            </optgroup>
                                            <optgroup label="Aktiv (regelmäßige Bewegung)">
                                                <option value="Aktiv">Handwerker*in</option>
                                                <option value="Aktiv">Zusteller*in</option>
                                                <option value="Aktiv">Gärtner*in</option>
                                            </optgroup>
                                            <optgroup label="Athlet (intensives Training)">
                                                <option value="Athlet">Profisportler*in</option>
                                                <option value="Athlet">Bauarbeiter*in</option>
                                                <option value="Athlet">Feuerwehrmann/-frau</option>
                                            </optgroup>
                                            <option value="none">Mein Beruf ist nicht aufgelistet</option>
                                        </select>
                                    </div>

                                    <!-- Schritt 2: Fragen für nicht aufgelistete Berufe -->
                                    <div id="step2" style="display: none;">
                                        <p>Bitte beantworte folgende Fragen, um dein Aktivitäts-Level zu bestimmen:</p>
                                        <div class="mt-3">
                                            <label>Wie viel Zeit verbringst du im Sitzen?</label>
                                            <select class="form-select" id="sitzenSelect">
                                                <option value="">Bitte wählen...</option>
                                                <option value="Sitzend">Die meiste Zeit</option>
                                                <option value="Stehend">Wenig</option>
                                                <option value="Aktiv">Kaum</option>
                                            </select>
                                        </div>
                                        <div class="mt-3">
                                            <label>Wie oft bewegst du dich während deiner Arbeit?</label>
                                            <select class="form-select" id="bewegungSelect">
                                                <option value="">Bitte wählen...</option>
                                                <option value="Sitzend">Kaum</option>
                                                <option value="Stehend">Gelegentlich</option>
                                                <option value="Aktiv">Häufig</option>
                                                <option value="Athlet">Sehr oft</option>
                                            </select>
                                        </div>
                                        <div class="mt-3">
                                            <label>Wie anstrengend ist deine Tätigkeit körperlich?</label>
                                            <select class="form-select" id="anstrengungSelect">
                                                <option value="">Bitte wählen...</option>
                                                <option value="Sitzend">Gar nicht</option>
                                                <option value="Stehend">Leicht</option>
                                                <option value="Aktiv">Moderat</option>
                                                <option value="Athlet">Sehr anstrengend</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                    <button type="button" class="btn btn-primary" id="nextStepButton">Weiter</button>
                                    <button type="button" class="btn btn-success" id="submitButton" style="display: none;">Fertig</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        document.addEventListener("DOMContentLoaded", () => {
                            const jobSelect = document.getElementById("jobSelect");
                            const sitzenSelect = document.getElementById("sitzenSelect");
                            const bewegungSelect = document.getElementById("bewegungSelect");
                            const anstrengungSelect = document.getElementById("anstrengungSelect");
                            const nextStepButton = document.getElementById("nextStepButton");
                            const submitButton = document.getElementById("submitButton");
                            const step1 = document.getElementById("step1");
                            const step2 = document.getElementById("step2");
                            const aktivitaetsLevelSelect = document.getElementById("Aktivitäts-Level");

                            let selectedLevel = "";

                            nextStepButton.addEventListener("click", () => {
                                if (step1.style.display !== "none") {
                                    if (jobSelect.value === "") {
                                        alert("Bitte wähle eine Option aus.");
                                        return;
                                    }

                                    if (jobSelect.value === "none") {
                                        step1.style.display = "none";
                                        step2.style.display = "block";
                                        nextStepButton.style.display = "none";
                                        submitButton.style.display = "inline-block";
                                    } else {
                                        selectedLevel = jobSelect.value;
                                        aktivitaetsLevelSelect.value = selectedLevel;
                                        showSuccessMessage();
                                        closeModal();
                                    }
                                }
                            });

                            submitButton.addEventListener("click", () => {
                                const sitzenValue = sitzenSelect.value;
                                const bewegungValue = bewegungSelect.value;
                                const anstrengungValue = anstrengungSelect.value;

                                if (!sitzenValue || !bewegungValue || !anstrengungValue) {
                                    alert("Bitte beantworte alle Fragen.");
                                    return;
                                }

                                // Entscheidungslogik
                                if (anstrengungValue === "Athlet" || bewegungValue === "Athlet") {
                                    selectedLevel = "Athlet";
                                } else if (bewegungValue === "Aktiv") {
                                    selectedLevel = "Aktiv";
                                } else if (sitzenValue === "Stehend" && bewegungValue === "Stehend") {
                                    selectedLevel = "Stehend";
                                } else {
                                    selectedLevel = "Sitzend";
                                }

                                
                                document.getElementById("BTN_modal_AktivitätsLevel_Festlegen").click; // URSPRÜNGLICHES MODAL WIEDER ÖFFNEN!

                                aktivitaetsLevelSelect.value = selectedLevel;
                                showSuccessMessage();
                                closeModal();
                            });

                            function showSuccessMessage() {
                                const message = new nachricht_func({
                                    duration: 5000,
                                    position: {
                                        x: "right",
                                        y: "top",
                                    },
                                    dismissible: true,
                                });
                                message.success(`Dein Aktivitäts-Level wurde auf "${selectedLevel}" gesetzt.`);
                            }

                            function closeModal() {
                                const modal = bootstrap.Modal.getInstance(document.getElementById("aktivitaetsLevelModal"));
                                modal.hide();
                            }
                        });
                    </script>




                    <!-- Modal -->
                    <div class="modal fade" id="modal_AktivitätsLevel_Festlegen" tabindex="-1" aria-labelledby="modal_Erstellen" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="https://dashboard.{{ WhiteLabel['Domain'] }}/Ernährung-Analyse/aktualisieren/Level?Redirect_URL=https://dashboard.{{ WhiteLabel['Domain'] }}/Ernährung-Analyse/Tracking" method="post" id="Erstellen_FORM">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Aktivitäts-Level anpassen</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="alert alert-info" role="alert">
                                            <h4 class="alert-heading">Aktivitäts-Level Übersicht</h4>
                                            <p>Hier findest Du eine Übersicht, was unter den verschiedenen Aktivitäts-Leveln zu verstehen ist:</p>
                                            <hr>
                                            <p class="mb-0">
                                                <strong>Sitzend (geringe Aktivität):</strong> Personen, die den Großteil des Tages sitzend verbringen, z. B. Büroangestellte oder Buchhalter*innen. <br>
                                                <strong>Stehend (leichte Tätigkeit):</strong> Tätigkeiten, bei denen man längere Zeit steht oder sich leicht bewegt, z. B. Verkäufer*innen oder Lehrer*innen. <br>
                                                <strong>Aktiv (regelmäßige Bewegung):</strong> Personen mit häufiger Bewegung, z. B. Handwerker*innen oder Zusteller*innen. <br>
                                                <strong>Athlet (intensives Training):</strong> Personen mit intensiver körperlicher Belastung, z. B. Profisportler*innen oder Bauarbeiter*innen.
                                            </p>
                                        </div>
                                        

                                        <div class="form-group mb-3">
                                            <label for="Aktivitäts-Level">Aktivitäts-Level</label>
                                            <select class="form-select" name="Aktivitäts-Level" id="Aktivitäts-Level">
                                                <option value="Sitzend" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level'] == "Sitzend" %}selected{% endif %}>Sitzend (geringe Aktivität)</option>
                                                <option value="Stehend" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level'] == "Stehend" %}selected{% endif %}>Stehend (leichte Tätigkeit)</option>
                                                <option value="Aktiv" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level'] == "Aktiv" %}selected{% endif %}>Aktiv (regelmäßige Bewegung)</option>
                                                <option value="Athlet" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level'] == "Athlet" %}selected{% endif %}>Athlet (intensives Training)</option>
                                            </select>
                                        </div>

                                        <div class="alert alert-warning alert-dismissible fade show mb-3" role="alert">
                                            Es ist wichtig, bei der Auswahl des Aktivitäts-Levels ehrlich zu sein, um z.B. Ernährungsempfehlungen oder Aktivitätsziele besser anzupassen.
                                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                        </div>

                                        <!-- Button zum Öffnen des Modals -->
                                        <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#aktivitaetsLevelModal">
                                            Assistent zur Bestimmung Dienes Aktivitäts-Levels
                                        </button>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                        <button type="submit" class="btn btn-primary">Aktivitäts-Level anpassen</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="modal fade" id="modal_ErnährungsZiel_Festlegen" tabindex="-1" aria-labelledby="modal_Erstellen" aria-hidden="true">
                        <div class="modal-dialog">
                            <form action="https://dashboard.{{ WhiteLabel['Domain'] }}/Ernährung-Analyse/aktualisieren/Ziel?Redirect_URL=https://dashboard.{{ WhiteLabel['Domain'] }}/Ernährung-Analyse/Tracking" method="post" id="Erstellen_FORM">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Ernährungs-Ziel anpassen</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-group mb-3">
                                            <label for="Ernährungs-Ziel">Ernährungs-Ziel</label>
                                            <select class="form-select" name="Ernährungs-Ziel" id="Ernährungs-Ziel">
                                                <option value="Gewichtsreduktion" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Ernaehrungs_ZIEL'] == "Gewichtsreduktion" %}selected{% endif %}>Gewichtsreduktion</option>
                                                <option value="Muskelaufbau" {% if ErnährungsAnalyse_Details['Nutzer_Details']['Ernaehrungs_ZIEL'] == "Muskelaufbau" %}selected{% endif %}>Muskelaufbau</option>
                                            </select>                                            
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                        <button type="submit" class="btn btn-primary">Ernährungs-Ziel anpassen</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>




                    <div class="modal fade" id="NahrungEintragen_MODAL" tabindex="-1" aria-labelledby="NahrungEintragen_MODAL" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="NahrungEintragen_MODAL">Füge Deine Mahlzeiten hinzu</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <style>
                                        .image-container {
                                            display: flex;
                                            justify-content: center; /* Bilder links ausrichten */
                                            gap: 10px; /* Abstand zwischen den Bildern */
                                            margin-top: 10px; /* Abstand oberhalb der Bilder */
                                        }
                                    
                                        .image-container img {
                                            height: 40px; /* Einheitliche Höhe der Bilder */
                                            border-radius: 5px; /* Abgerundete Ecken */
                                            transition: transform 0.2s, box-shadow 0.2s; /* Animation bei Hover */
                                            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Leichter Schatten */
                                            cursor: pointer;
                                        }
                                    
                                        .image-container img:hover {
                                            transform: scale(1.05); /* Vergrößert das Bild leicht bei Hover */
                                            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Stärkerer Schatten bei Hover */
                                        }

                                        .scanner-container {
                                            display: flex;
                                            flex-direction: column;
                                            align-items: center;
                                            margin-top: 20px;
                                        }

                                        #barcode-scanner {
                                            width: 100%;
                                            max-width: 400px;
                                            height: 300px;
                                            background: #f0f0f0;
                                            border: 1px solid #ddd;
                                            margin-bottom: 10px;
                                        }

                                        .scanner-buttons {
                                            display: flex;
                                            gap: 10px;
                                        }

                                        .scanner-buttons button {
                                            padding: 10px 15px;
                                            font-size: 16px;
                                        }
                                    </style>

                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="searchInput" placeholder="Produktname eingeben" aria-label="Produktsuche">
                                        <button class="btn btn-outline-secondary" type="button" id="searchButton">Suchen</button>
                                    </div>

                                    <div class="scanner-container" id="scanner-container">
                                        <div id="barcode-scanner"></div>
                                        <div class="scanner-buttons">
                                            <button id="start-scanner" class="btn btn-primary">Scanner starten</button>
                                            <button id="stop-scanner" class="btn btn-danger">Scanner stoppen</button>
                                        </div>
                                    </div>


                                    <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
                                    <script>
                                        const scannerContainer = document.getElementById('scanner-container');
    
                                        // Prüfen, ob das Gerät ein Handy ist
                                        function isMobileDevice() {
                                            return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
                                        }

                                        if (isMobileDevice()) {
                                            // Zeige den Scanner nur auf mobilen Geräten
                                            scannerContainer.style.display = 'block';
                                        } else {
                                            // Verberge den Scanner auf nicht-mobilen Geräten
                                            scannerContainer.style.display = 'none';
                                        }

                                        const searchInput = document.getElementById('searchInput');
                                        const startScannerButton = document.getElementById('start-scanner');
                                        const stopScannerButton = document.getElementById('stop-scanner');

                                        // Funktion zum Starten des Barcode-Scanners
                                        function startScanner() {
                                            Quagga.init(
                                                {
                                                    inputStream: {
                                                        name: "Live",
                                                        type: "LiveStream",
                                                        target: document.querySelector('#barcode-scanner'),
                                                        constraints: {
                                                            width: 400,
                                                            height: 300,
                                                            facingMode: "environment" // Rückkamera verwenden
                                                        }
                                                    },
                                                    decoder: {
                                                        readers: ["ean_reader"] // EAN-Barcode-Format lesen
                                                    }
                                                },
                                                function (err) {
                                                    if (err) {
                                                        console.error("Quagga init error:", err);
                                                        return;
                                                    }
                                                    Quagga.start();
                                                }
                                            );

                                            // Event-Listener für erkannte Codes
                                            Quagga.onDetected((data) => {
                                                const code = data.codeResult.code;
                                                console.log("Barcode erkannt:", code);
                                                searchInput.value = code; // Automatisch die EAN ins Eingabefeld einfügen
                                                stopScanner(); // Scanner nach erfolgreichem Scan stoppen
                                            });
                                        }

                                        // Funktion zum Stoppen des Barcode-Scanners
                                        function stopScanner() {
                                            Quagga.stop();
                                            document.getElementById('scanner-container').style.display = 'none';
                                        }

                                        // Event-Listener für Buttons
                                        startScannerButton.addEventListener('click', startScanner);
                                        stopScannerButton.addEventListener('click', stopScanner);
                                    </script>



                                    <!-- Ladeanimation -->
                                    <div id="loadingAnimation" style="display: none; text-align: center; margin-top: 20px;">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Lädt...</span>
                                        </div>
                                        <p>Produkte werden geladen...</p>
                                    </div>


                                    <div class="DB_FOOD_SUCHERGEBNISE" style="display: none;">
                                        <!-- Dynamisch generierte Karten werden hier hinzugefügt -->
                                    </div>
                                </div>
                                
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                    <!--
                                        <button type="button" class="btn btn-primary">Save changes</button>
                                    -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        document.addEventListener("DOMContentLoaded", () => {
                            const searchButton = document.getElementById("searchButton");
                            const searchInput = document.getElementById("searchInput");
                            const resultsContainer = document.querySelector(".DB_FOOD_SUCHERGEBNISE");
                            const loadingAnimation = document.getElementById("loadingAnimation");
                            const modal = new bootstrap.Modal(document.getElementById("imageModal"));
                            const modalImage = document.getElementById("modalImage");

                            searchButton.addEventListener("click", async () => {
                                const searchQuery = searchInput.value.trim();
                                if (!searchQuery) {
                                    alert("Bitte geben Sie einen Suchbegriff ein.");
                                    return;
                                }

                                // Ladeanimation anzeigen
                                loadingAnimation.style.display = "block";
                                resultsContainer.style.display = "none";

                                const apiUrl = `https://dashboard.personalpeak360.de/food-api/suche?Suche=${encodeURIComponent(searchQuery)}&Seite=1&Seite_LIMIT=10`;
                                
                                try {
                                    const response = await fetch(apiUrl);
                                    if (!response.ok) throw new Error("Fehler beim Abrufen der Daten.");
                                    const data = await response.json();
                                    displayResults(data);
                                } catch (error) {
                                    console.error(error);
                                    alert("Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.");
                                } finally {
                                    // Ladeanimation ausblenden
                                    loadingAnimation.style.display = "none";
                                }
                            });

                            function displayResults(data) {
                                resultsContainer.classList.add('text-center')
                                resultsContainer.innerHTML = ""; // Vorherige Ergebnisse entfernen
                                resultsContainer.style.display = "block";

                                if (data.length === 0) {
                                    resultsContainer.innerHTML = "<p>Keine Ergebnisse gefunden.</p>";
                                    return;
                                }

                                data.forEach((item) => {
                                    const card = document.createElement("div");
                                    card.className = "card mb-3";
                                    card.style.cssText = "display: flex; align-items: center; border: 1px solid #ddd; border-radius: 10px; padding: 10px; cursor: pointer;";

                                    const imageDiv = document.createElement("div");
                                    imageDiv.style.flexShrink = "0";

                                    const productImage = document.createElement("img");
                                    productImage.src = item.images.image_url || "https://cdn.{{ WhiteLabel['Domain'] }}/assets/images/Food-API/default.svg";
                                    productImage.alt = item.product_name || "Produktbild";
                                    productImage.style.cssText = "width: 150px; height: 150px; object-fit: cover; border-radius: 10px;";
                                    imageDiv.appendChild(productImage);

                                    const cardBody = document.createElement("div");
                                    cardBody.className = "card-body";
                                    cardBody.style.marginLeft = "15px";

                                    const cardTitle = document.createElement("h5");
                                    cardTitle.className = "card-title";
                                    cardTitle.textContent = `${item.product_name || "Unbekanntes Produkt"} (${item.Typ || "Unbekannte Herkunft"})`;

                                    const cardDescription = document.createElement("p");
                                    cardDescription.className = "card-text";
                                    cardDescription.innerHTML = `Marke/n: ${item.brands || "Unbekannt"} <br> Menge: ${item.quantity || "Unbekannt"}`;

                                    const imageContainer = document.createElement("div");
                                    imageContainer.className = "image-container";

                                    const nutriScoreImage = createClickableImage(`https://cdn.{{ WhiteLabel['Domain'] }}/assets/images/Food-API/NutriScore/nutriscore-${item.Scores.NutriScore || "unknown"}-new-de.svg`);
                                    const novaScoreImage = createClickableImage(`https://cdn.{{ WhiteLabel['Domain'] }}/assets/images/Food-API/NovaScore/nova-group-${item.Scores.NovaScore || "unknown"}.svg`);
                                    const ecoScoreImage = createClickableImage(`https://cdn.{{ WhiteLabel['Domain'] }}/assets/images/Food-API/EcoScore/ecoscore-${item.Scores.EcoScore || "unknown"}.svg`);

                                    imageContainer.append(nutriScoreImage, novaScoreImage, ecoScoreImage);

                                    cardBody.append(cardTitle, cardDescription, imageContainer);
                                    card.append(imageDiv, cardBody);
                                    resultsContainer.appendChild(card);


                                    // Event-Listener für das dynamische Modal
                                    card.addEventListener("click", () => {
                                        createAndShowDynamicModal(item);
                                    });
                                });

                                // addImageClickListeners();
                            }



                            function createAndShowDynamicModal(item) {
                                // Referenz auf das bestehende Modal
                                const existingModalElement = document.getElementById("NahrungEintragen_MODAL");
                                const existingModalInstance = bootstrap.Modal.getInstance(existingModalElement);

                                // Dynamisches Modal erstellen
                                const modalContainer = document.createElement("div");

                                // Modal-HTML für das dynamische Modal
                                const dynamicModalHtml = `
                                    <div class="modal fade" id="dynamicModalLabel" tabindex="-1" aria-labelledby="dynamicModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="dynamicModalLabel">${item.product_name || "Unbekanntes Produkt"}</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body text-center">
                                                    <img src="${item.images.image_url || "https://cdn.{{ WhiteLabel['Domain'] }}/assets/images/Food-API/default.svg"}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 10px;" alt="${item.product_name || "Produktbild"}" class="img-fluid">
                                                    <p class="mt-3">Marke/n: ${item.brands || "Unbekannt"}</p>
                                                    ${
                                                        item.Typ === "Datenbank"
                                                            ? `<p>Menge: ${item.Menge?.Produkt?.Menge || "Unbekannt"}</p>`
                                                            : `<p>Menge: ${item.Menge?.Produkt?.Menge || "Unbekannt"} ${item.Menge?.Produkt?.Einheit || "Unbekannte Einheit"}</p>`
                                                    }

                                                    <p>
                                                        Kalorien pro Einheit: 
                                                        <strong>
                                                            ${
                                                                item.Typ === "Datenbank"
                                                                    ? item.nutriments['calories'] || "Unbekannt"
                                                                    : item.nutriments['energy-kcal'] || "Unbekannt"
                                                            }
                                                        </strong> kcal
                                                    </p>
                                                    <div class="input-group mb-3">
                                                        <input type="number" id="quantityInput" class="form-control" placeholder="Anzahl eingeben" min="0.1" value="1">
                                                        <button class="btn btn-primary" id="addCaloriesButton">Kalorien hinzufügen</button>
                                                    </div>

                                                    <hr>
                                                    <h5>Nährwertangaben</h5>
                                                    ${
                                                        item.Typ !== "Datenbank" && item.nutriments && Object.keys(item.nutriments).length > 0
                                                            ? `
                                                                <table class="table table-striped mt-3">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Nährwertangaben</th>
                                                                            <th>So wie verkauft (${item.Menge.Produkt.Menge || "Unbekannt"} ${item.Menge.Produkt.Einheit || "Unbekannte Einheit"})</th>
                                                                            <th>Pro Portion (${item.Menge.Portion.Menge || "Unbekannt"} ${item.Menge.Portion.Einheit || "Unbekannte Einheit"})</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        ${Object.entries(item.nutriments)
                                                                            .filter(
                                                                                ([key]) =>
                                                                                    key !== "nova-group" &&
                                                                                    !key.endsWith("_100g") &&
                                                                                    !key.endsWith("_serving") &&
                                                                                    !key.endsWith("_unit") &&
                                                                                    !key.endsWith("_value") &&
                                                                                    !key.endsWith("_value_computed")
                                                                            )
                                                                            .map(([key]) => {
                                                                                const translations = {
                                                                                    "carbohydrates": "Kohlenhydrate",
                                                                                    "carbohydrates_100g": "Kohlenhydrate (pro 100g)",
                                                                                    "carbohydrates_serving": "Kohlenhydrate (pro Portion)",
                                                                                    "energy": "Energie",
                                                                                    "energy-kcal": "Kalorien (kcal)",
                                                                                    "energy-kcal_100g": "Kalorien (pro 100g)",
                                                                                    "energy-kcal_serving": "Kalorien (pro Portion)",
                                                                                    "energy-KJ": "Energie (kJ)",
                                                                                    "energy-KJ_100g": "Energie (pro 100g)",
                                                                                    "energy-KJ_serving": "Energie (pro Portion)",
                                                                                    "fat": "Fett",
                                                                                    "fat_100g": "Fett (pro 100g)",
                                                                                    "fat_serving": "Fett (pro Portion)",
                                                                                    "fiber": "Ballaststoffe",
                                                                                    "fiber_100g": "Ballaststoffe (pro 100g)",
                                                                                    "fiber_serving": "Ballaststoffe (pro Portion)",
                                                                                    "proteins": "Proteine",
                                                                                    "proteins_100g": "Proteine (pro 100g)",
                                                                                    "proteins_serving": "Proteine (pro Portion)",
                                                                                    "salt": "Salz",
                                                                                    "salt_100g": "Salz (pro 100g)",
                                                                                    "salt_serving": "Salz (pro Portion)",
                                                                                    "saturated-fat": "Gesättigte Fette",
                                                                                    "saturated-fat_100g": "Gesättigte Fette (pro 100g)",
                                                                                    "saturated-fat_serving": "Gesättigte Fette (pro Portion)",
                                                                                    "sodium": "Natrium",
                                                                                    "sodium_100g": "Natrium (pro 100g)",
                                                                                    "sodium_serving": "Natrium (pro Portion)",
                                                                                    "sugars": "Zucker",
                                                                                    "sugars_100g": "Zucker (pro 100g)",
                                                                                    "sugars_serving": "Zucker (pro Portion)",
                                                                                    "cholesterol": "Cholesterin",
                                                                                    "cholesterol_100g": "Cholesterin (pro 100g)",
                                                                                    "cholesterol_serving": "Cholesterin (pro Portion)",
                                                                                    "trans-fat": "Transfette",
                                                                                    "trans-fat_100g": "Transfette (pro 100g)",
                                                                                    "trans-fat_serving": "Transfette (pro Portion)",
                                                                                    "vitamin-a": "Vitamin A",
                                                                                    "vitamin-a_100g": "Vitamin A (pro 100g)",
                                                                                    "vitamin-a_serving": "Vitamin A (pro Portion)",
                                                                                    "vitamin-c": "Vitamin C",
                                                                                    "vitamin-c_100g": "Vitamin C (pro 100g)",
                                                                                    "vitamin-c_serving": "Vitamin C (pro Portion)",
                                                                                    "iron": "Eisen",
                                                                                    "iron_100g": "Eisen (pro 100g)",
                                                                                    "iron_serving": "Eisen (pro Portion)",
                                                                                    "calcium": "Kalzium",
                                                                                    "calcium_100g": "Kalzium (pro 100g)",
                                                                                    "calcium_serving": "Kalzium (pro Portion)",
                                                                                    "nova-group": "NOVA Gruppe",
                                                                                    "nutrition-score-fr": "Nährwert-Score (FR)",
                                                                                    "nutrition-score-fr_100g": "Nährwert-Score (FR, pro 100g)",
                                                                                    "fruits-vegetables-nuts": "Obst, Gemüse und Nüsse",
                                                                                    "fruits-vegetables-nuts_100g": "Obst, Gemüse und Nüsse (pro 100g)",
                                                                                    "fruits-vegetables-nuts_serving": "Obst, Gemüse und Nüsse (pro Portion)",
                                                                                    "carbon-footprint-from-known-ingredients": "CO2-Fußabdruck (bekannte Zutaten)",
                                                                                    "carbon-footprint-from-known-ingredients_100g": "CO2-Fußabdruck (pro 100g)",
                                                                                    "carbon-footprint-from-known-ingredients_serving": "CO2-Fußabdruck (pro Portion)"
                                                                                };

                                                                                const translatedKey = translations[key] || key.replace(/-/g, " ").toUpperCase(); // Übersetzung oder Original
                                                                                const nutrientValue100g = item.nutriments[`${key}_100g`] || "–";
                                                                                const nutrientValueServing = item.nutriments[`${key}_serving`] || "–";
                                                                                const nutrientUnit = item.nutriments[`${key}_unit`] || "";

                                                                                return `
                                                                                    <tr>
                                                                                        <td>${translatedKey}</td>
                                                                                        <td>${nutrientValue100g} ${nutrientUnit}</td>
                                                                                        <td>${nutrientValueServing} ${nutrientUnit}</td>
                                                                                    </tr>
                                                                                `;
                                                                            })
                                                                            .join("")}
                                                                    </tbody>
                                                                </table>
                                                            `
                                                            : '<p>Keine Nährwertangaben verfügbar.</p>'
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;

                                // Modal-Container mit HTML füllen und in den DOM einfügen
                                modalContainer.innerHTML = dynamicModalHtml;
                                document.body.appendChild(modalContainer);

                                // Dynamisches Modal initialisieren
                                const dynamicModalInstance = new bootstrap.Modal(document.getElementById("dynamicModalLabel"));

                                // Schließe das bestehende Modal, bevor das dynamische Modal geöffnet wird
                                if (existingModalInstance) {
                                    existingModalInstance.hide();

                                    // Event-Listener, um das dynamische Modal zu öffnen, nachdem das bestehende Modal geschlossen wurde
                                    existingModalElement.addEventListener("hidden.bs.modal", () => {
                                        dynamicModalInstance.show();
                                    });
                                } else {
                                    dynamicModalInstance.show();
                                }

                                // Event-Listener, um das bestehende Modal wieder zu öffnen, nachdem das dynamische Modal geschlossen wurde
                                const dynamicModalElement = document.getElementById("dynamicModalLabel");
                                dynamicModalElement.addEventListener("hidden.bs.modal", () => {
                                    dynamicModalInstance.dispose(); // Dynamisches Modal aus dem DOM entfernen
                                    dynamicModalElement.remove();

                                    // Bestehendes Modal wieder öffnen
                                    if (existingModalInstance) {
                                        existingModalInstance.show();
                                    }
                                });


                                // Event-Listener für den Button
                                document.getElementById("addCaloriesButton").addEventListener("click", () => {
                                    const quantity = parseFloat(document.getElementById("quantityInput").value, 10);
                                    if (isNaN(quantity) || quantity <= 0) {
                                        alert("Bitte eine gültige Anzahl eingeben.");
                                        return;
                                    }

                                    // Kalorien pro Einheit basierend auf dem Typ ermitteln
                                    const caloriesPerUnit =
                                        item.Typ === "Datenbank"
                                            ? item.nutriments['calories'] || 0
                                            : item.nutriments['energy-kcal'] || 0;

                                    // Kalorien berechnen und hinzufügen
                                    const totalCalories = caloriesPerUnit * quantity;
                                    
                                    console.log(item)
                                    addCalories(totalCalories, item); // Funktion aufrufen
                                    alert(`${totalCalories} kcal wurden hinzugefügt.`);
                                    dynamicModal.hide(); // Modal schließen
                                });
                            }


                            function createClickableImage(src) {
                                const image = document.createElement("img");
                                image.src = src;
                                image.alt = "Score";
                                image.className = "clickable-image";
                                image.style.cssText = "height: 40px; border-radius: 5px; cursor: pointer;";

                                // image.addEventListener("click", () => {
                                //     modalImage.src = src;
                                //     modal.show();
                                // });

                                return image;
                            }

                            function addImageClickListeners() {
                                document.querySelectorAll(".clickable-image").forEach((image) => {
                                    image.addEventListener("click", () => {
                                        modalImage.src = image.src;
                                        modal.show();
                                    });
                                });
                            }
                        });
                    </script>
                    
                    


                    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="NahrungEintragen_MODAL" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="NahrungEintragen_MODAL">Infos zu "Zertifizierung"</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <img id="modalImage" src="" alt="Große Ansicht" style="width: 100%; height: auto; border-radius: 10px;">
                                </div>
                                
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Schließen</button>
                                </div>
                            </div>
                        </div>
                    </div>


					{% if ErnährungsAnalyse_Details['Letzter_FitnessTest']['Status'] != "Abgeschlossen" and ErnährungsAnalyse_Details['Letzter_FitnessTest']['Status'] != "Keine Daten verfügbar" %}
						<div class="alert alert-info alert-dismissible text-center" role="alert" id="trainings-info">
							<h4 class="alert-heading" id="trainings-title">Ernährungsplan wird erstellt!</h4>
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							<p id="trainings-description">Dein Ernährungsplan wird gerade erstellt. Bitte habe einen Moment Geduld, während wir alle relevanten Daten analysieren und deinen individuellen Plan zusammenstellen.</p>
							<div style="display: block; margin-left: auto; margin-right: auto; width: fit-content;" id="flipdown2" class="flipdown"></div>
							<hr>
							<p class="mb-0" id="trainings-footer">In der Zwischenzeit hast du trotzdem vollen Zugriff auf den Bereich Ernährung und Analyse.</p>
						</div>

						<script>
							document.addEventListener("DOMContentLoaded", function () {
								// Überprüfen, ob das Ziel-Element existiert
								const flipdownElement = document.getElementById('flipdown2');
								if (!flipdownElement) {
									console.error('FlipDown element not found!');
									return;
								}

								// Zeitstempel aus Jinja2 (ISO-Format)
								var timestamp = "{{ ErnährungsAnalyse_Details['Letzter_FitnessTest']['Daten']['Zeitstempel'] }}";
								if (!timestamp) {
									console.error('Zeitstempel fehlt!');
									return;
								}

								// Konvertiere das Ziel-Datum in einen Unix-Zeitstempel (in Sekunden)
								var currentDate = Math.floor(new Date(timestamp).getTime() / 1000);

								// 48 Stunden in Sekunden
								var hours48 = 48 * 60 * 60;

								// Ziel-Datum (heute + 48 Stunden)
								var targetDate = currentDate + hours48;

								// FlipDown initialisieren
								var flipdown = new FlipDown(targetDate, 'flipdown2', {
									headings: ["Tage", "Stunden", "Minuten", "Sekunden"]
								})
									// Countdown starten
									.start()
									// Funktion ausführen, wenn der Countdown endet
									.ifEnded(() => {
										console.log('Der Countdown ist abgelaufen!');

										// Ändere den Inhalt der Meldung
										const infoContainer = document.getElementById('trainings-info');
										infoContainer.classList.remove('alert-info');
										infoContainer.classList.add('alert-warning');

										document.getElementById('trainings-title').textContent = 'Dein Ernährungsplan verzögert sich!';
										document.getElementById('trainings-description').textContent =
											'Leider ist dein Trainer derzeit im Verzug. Dies kann verschiedene Gründe haben, wie eine unerwartete Arbeitslast oder technische Probleme.';
										document.getElementById('flipdown2').style.display = 'none'; // Verberge den Countdown
										document.getElementById('trainings-footer').textContent =
											'Bitte setze dich mit deinem Trainer in Verbindung, um weitere Informationen zu erhalten.';
									});
							});
						</script>
					{% endif %}

                    
                    <div class="card radius-15 mb-3">
                        <div class="card-body">
                            <div class="card-title">
                                <h4 class="mb-0">Ernährungs-Tracking</h4>
                                <h6 class="mb-0">Verfolge Deine Mahlzeiten, Snacks und Getränke, um Deine Ernährungsziele zu erreichen und Deine Fortschritte im Blick zu behalten.</h6>
                                
                                <hr/>
                                <button type="button" class="btn btn-primary mb-0 me-2" data-bs-toggle="modal" data-bs-target="#modal_ErnährungsZiel_Festlegen">Ziel ändern</button>
                                <button type="button" class="btn btn-primary mb-0" id="BTN_modal_AktivitätsLevel_Festlegen" data-bs-toggle="modal" data-bs-target="#modal_AktivitätsLevel_Festlegen">Aktivitäts-Level ändern</button>
                            </div>
                        </div>
                    </div>

                    <div class="card radius-15">
                        <div class="card-body">
                            <div class="card-title date-title mb-3">
                                <h4 class="mb-0 text-center">{{ current_date.strftime('%A, der %d.%m.%Y') }}</h4>
                            </div>

                            <div class="alert text-center caloriesMsg alert-info">Starte Deinen Tag - trage Dein erstes Essen ein!</div>

                            <div class="row selectedCalPlan" style="">
                                <div class="col-lg-2 col-md-6 offset-md-3 offset-lg-0">
                                    <div class="water-handler h-100">
                                        <div class="water-bottle">
                                            <div class="cap">
                                                <div class="cap-top">
                                                </div>
                                                <div class="cap-seal">
                                                </div>
                                            </div>
                                            <div class="bottle">
                                                <div class="water-level" style="height: 0px; margin-top: 190px;"> </div>
                                            </div>
                                        </div>
                                        <div class="texter">
                                            <h3 class="m-0" style="padding: 5px 0">Wasser</h3>
                                            <div class="button-container">
                                                <div class="water-button-wrapper">
                                                    <button class="water-button">
                                                        <span data-bs-toggle="tooltip" data-bs-placement="right" class="bx bx-plus" aria-label="Wasser hinzufügen (0,5 Liter)" data-bs-original-title="Wasser hinzufügen (0,5 Liter)"></span>
                                                    </button>
                                                </div>
                                                <div class="water-button-wrapper">
                                                    <button class="water-button-minus">
                                                        <span data-bs-toggle="tooltip" data-bs-placement="right" class="bx bx-minus" aria-label="Wasser entfernen (0,5 Liter)" data-bs-original-title="Wasser entfernen (0,5 Liter)"></span>
                                                    </button>
                                                </div>
                                            </div>
                                            <p>0/5</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-none d-md-inline d-lg-none my-3"></div>
                                <div class="col-lg-4 col-md-6">
                                    <div class="cal-img">
                                        <img src="https://personal-peak-360.de/fitness/assets/level-map.jpg" width="100%">
                                        <div class="score-overlay" style="height:80%;"></div>
                                        <div class="score-overlay-ver" style="height:0%;"></div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="calorimeter text-center h-100 pt-5 pb-2" style="background: linear-gradient(45deg, rgb(255, 55, 0), rgb(155, 0, 0));">
                                        <h2>Verzehrte Kalorien</h2>
                                        <div class="calories-count">
                                            <h2 class="col-12 d-flex justify-content-center align-items-center">0</h2>
                                        </div>
                                        <div class="additional-cal-info">
                                            <h4>Zielkalorien: <span class="target-cal">2312</span> - Fülle Deine&nbsp;Pyramide!!</h4>
                                        </div>
                                        <button class="btn btn-warning mt-2" data-bs-toggle="modal" data-bs-target="#NahrungEintragen_MODAL">Gegessenes eintragen</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <style>
                        /* Container für die beiden Buttons */
                        .button-container {
                            display: flex;
                            justify-content: center; /* Zentriere beide Wrapper horizontal */
                            align-items: center; /* Zentriere beide Wrapper vertikal */
                            gap: 10px; /* Abstand zwischen den Button-Containern */
                        }

                        /* Wrapper für einzelne Buttons */
                        .water-button-wrapper {
                            display: flex;
                            justify-content: center; /* Zentriere den Button horizontal */
                            align-items: center; /* Zentriere den Button vertikal */
                            width: 60px; /* Breite des Containers */
                            height: 60px; /* Höhe des Containers */
                            border-radius: 10px; /* Optionale abgerundete Ecken */
                            transition: background-color 0.3s ease; /* Hover-Effekt für Hintergrundfarbe */
                        }
                    </style>
                    <script>
                        // Create an instance of Notyf
                        var nachricht = new nachricht_func({
                            duration: 5000,
                            position: {
                                x: 'right',
                                y: 'top',
                            },
                            dismissible: true
                        });
                    
                        var glassDrink = {{ Heutige_TRACKING_DATEN['Wasser'] }}; // Aktuelle Anzahl Gläser
                        var totalGlasses = {{ Letzte_Messung['Ergebnis_DATEN']["Wasserempfehlung"][ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level']]['glas'] }}; // Zielanzahl der Gläser
                    
                        // Funktion zum Aktualisieren des Wasserstands
                        function updateWaterLevel() {
                            const waterHeight = parseInt((glassDrink / totalGlasses) * 190);
                            const styler = `height: ${waterHeight}px; margin-top: ${190 - waterHeight}px;`;
                            document.querySelector('.water-level').setAttribute('style', styler);
                            document.querySelector('.water-handler p').innerHTML = `${glassDrink}/${totalGlasses}`;
                        }
                    
                        // Funktion zum Anzeigen von Toast-Nachrichten
                        function showToast(message) {
                            nachricht.success(message);
                        }
                    
                        // Präfix- und Suffix-Bausteine
                        const prefixes = [
                            "Super!", "Klasse!", "Prima!", "Toll!", "Fantastisch!",
                            "Genial!", "Stark!", "Erstaunlich!", "Grandios!", "Ausgezeichnet!",
                            "Hervorragend!", "Beeindruckend!", "Wunderbar!", "Exzellent!", "Spitze!",
                            "Mega!", "Cool!", "Hammer!", "Phänomenal!", "Bravo!"
                        ];
                    
                        const suffixes = [
                            "Weiter so!", "Wasser ist wichtig!", "Bleib dran!", "Toll gemacht!", 
                            "Mach weiter so!", "Du bist auf dem richtigen Weg!", "Einfach super!", 
                            "Gut für dich!", "Dein Körper dankt es dir!", "Fantastisch!", 
                            "Wasser hilft!", "Du schaffst das!", "Weiter geht's!", "Das tut gut!", 
                            "Bleib hydriert!", "Gesundheit pur!", "Du bist großartig!", 
                            "Das ist stark!", "Was für ein Erfolg!", "Dein Ziel ist nah!"
                        ];
                    
                        // Funktion zur Generierung der Nachricht
                        function generateWaterMessage(glassDrink) {
                            const liters = (glassDrink * 0.5).toFixed(1); // Berechnung der Liter
                            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)]; // Zufälliger Präfix
                            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)]; // Zufälliger Suffix
                            
                            return `${prefix} ${liters} Liter erreicht. ${suffix}`;
                        }
                    
                        // Funktion zum Senden der POST-Anfrage
                        async function sendWaterTrackingUpdate(glassDrink) {
                            try {
                                // JSON-Body erstellen
                                const data = {
                                    Typ: "Wasser",
                                    Wasser: glassDrink, // Anzahl der Wasser-Gläser
                                    Wasser_GESAMT: totalGlasses
                                };
                    
                                // POST-Anfrage senden
                                const response = await fetch('https://dashboard.{{ WhiteLabel["Domain"] }}/Ernährung-Analyse/Tracking', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data) // JSON-Body in die Anfrage einfügen
                                });
                    
                                // Antwort überprüfen
                                if (response.ok) {
                                    const result = await response.json();
                                    console.log('Erfolgreich aktualisiert:', result);
                                } else {
                                    console.error('Fehler beim Aktualisieren:', response.statusText);
                                    nachricht.error('Fehler beim Aktualisieren.');
                                }
                            } catch (error) {
                                console.error('Fehler beim Senden der Anfrage:', error);
                                nachricht.error('Fehler beim Aktualisieren.');
                            }
                        }
                    
                        // Funktion, die aufgerufen wird, wenn der Plus-Button geklickt wird
                        function onWaterButtonClick() {
                            if (glassDrink < totalGlasses) {
                                glassDrink++;
                                updateWaterLevel();
                                sendWaterTrackingUpdate(glassDrink);
                    
                                // Nachricht basierend auf der Anzahl der Gläser
                                const waterMessage = generateWaterMessage(glassDrink);
                                showToast(waterMessage);
                            } else {
                                showToast("Für heute hast Du das Ziel erreicht. Super gemacht!");
                            }
                        }
                    
                        // Funktion, die aufgerufen wird, wenn der Minus-Button geklickt wird
                        function onWaterButtonMinusClick() {
                            if (glassDrink > 0) {
                                glassDrink--;
                                updateWaterLevel();
                                sendWaterTrackingUpdate(glassDrink);
                    
                                // Nachricht für Minus-Button
                                showToast(`Ein Glas entfernt. Aktueller Stand: ${glassDrink}/${totalGlasses} Gläser.`);
                            } else {
                                showToast("Es gibt nichts zu entfernen.");
                            }
                        }
                    
                        // Event-Listener hinzufügen und Wasserstand initialisieren
                        document.addEventListener('DOMContentLoaded', function () {
                            updateWaterLevel(); // Initialer Wasserstand wird geladen
                            document.querySelector('.water-button').addEventListener('click', onWaterButtonClick); // Plus-Button
                            document.querySelector('.water-button-minus').addEventListener('click', onWaterButtonMinusClick); // Minus-Button
                        });
                    </script>
                    

                    

                    <script>
                        let currentCalories = {{ Heutige_TRACKING_DATEN['Kalorien_ANZAHL'] | default(0) }}; // Startwert der Kalorien
                        const targetCalories = {{ Letzte_Messung['Ergebnis_DATEN'][ErnährungsAnalyse_Details['Nutzer_Details']['Ernaehrungs_ZIEL']][ErnährungsAnalyse_Details['Nutzer_Details']['Aktivitaets_Level']]['Min_Kalorien'] | ceil_zero_decimal }}; // Zielwert der Kalorien

                        

                        // Funktion zur Interpolation von Farbwerten
                        function interpolateColor(percent) {
                            if(percent>=200){
                                percent=200;
                            }
                            var color1, color2;
                            if (percent <= 100) {
                                var r = 255-percent;
                                var g = 55+percent*2;
                                color1 = 'rgb(' + r + ', ' + g + ', 0)';
                                color2 = 'rgb(' + (r-100) + ', ' + (g-100) + ', 0)';
                            } else {
                                var r = 155+(percent-100);
                                var g = 255-(percent+55);
                                color1 = 'rgb(' + r + ', ' + g + ', 0)';
                                color2 = 'rgb(' + (r-100) + ', ' + (g-100) + ', 0)';
                            }
                            return 'linear-gradient(45deg, ' + color1 + ', ' + color2 + ')';
                        }


                        // Funktion zur Aktualisierung der Anzeige
                        function updateCaloriesDisplay() {
                            // Prozentualer Fortschritt berechnen
                            const percentCalories = Math.min((currentCalories / targetCalories) * 100, 100);
                            var curper = 0.8 * percentCalories;

                            // Unterschiedliche Werte für beide Overlays
                            const remainingHeight = `${(80 - curper) + 2}%`; // Noch verbleibender Fortschritt
                            const progressHeight = `${curper - 2}%`; // Tatsächlicher Fortschritt

                            // Aktualisierung der Overlays
                            document.querySelector('.score-overlay').style.height = remainingHeight;
                            document.querySelector('.score-overlay-ver').style.height = progressHeight;
                            // Dynamische Farbe bis zum aktuellen Fortschritt interpolieren
                            const startColor = "#ed0016"; // Startfarbe (Rot)
                            const endColor = "#0fb200";  // Endfarbe (Grün)
                            const gradient = interpolateColor(percentCalories);

                            document.querySelector('.calorimeter').style.background = gradient;

                            // Kalorienwerte anzeigen
                            document.querySelector('.calories-count h2').innerText = currentCalories;
                            document.querySelector('.additional-cal-info .target-cal').innerText = targetCalories;

                            // Nachricht basierend auf dem Fortschritt
                            let message = "";
                            if (percentCalories === 0) {
                                message = "Starte deinen Tag – trage deine erste Mahlzeit ein!";
                            } else if (percentCalories < 50) {
                                message = "Gut gemacht! Weiter so, um dein Ziel zu erreichen.";
                            } else if (percentCalories < 100) {
                                message = "Super, du bist auf einem guten Weg. Halte dein Tempo!";
                            } else if (percentCalories === 100) {
                                message = "Perfekt! Ziel erreicht. Behalte deine Balance.";
                            } else {
                                message = "Achtung, du bist heute schon über deinem Ziel! Morgen geht's weiter.";
                            }
                            document.querySelector('.caloriesMsg').innerText = message;
                        }

                        // Funktion zum Hinzufügen von Kalorien
                        async function addCalories(amount, item_data) {
                            currentCalories = Math.min(currentCalories + amount);
                            updateCaloriesDisplay();

                            try {
                                // JSON-Body erstellen
                                const data = {
                                    Typ: "Kalorien",
                                    Anzahl: amount, // Anzahl der Kalorien
                                    Item: item_data,
                                    Kalorien_DATA: {
                                        "Erreicht": currentCalories,
                                        "Ziel": targetCalories
                                    }
                                };
                    
                                // POST-Anfrage senden
                                const response = await fetch('https://dashboard.{{ WhiteLabel["Domain"] }}/Ernährung-Analyse/Tracking', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(data) // JSON-Body in die Anfrage einfügen
                                });
                    
                                // Antwort überprüfen
                                if (response.ok) {
                                    const result = await response.json();
                                    console.log('Erfolgreich aktualisiert:', result);
                                } else {
                                    console.error('Fehler beim Aktualisieren:', response.statusText);
                                    nachricht.error('Fehler beim Aktualisieren.');
                                }
                            } catch (error) {
                                console.error('Fehler beim Senden der Anfrage:', error);
                                nachricht.error('Fehler beim Aktualisieren.');
                            }
                        }

                        // Funktion zum Zurücksetzen der Kalorien
                        function resetCalories() {
                            currentCalories = 0;
                            updateCaloriesDisplay();
                        }

                        // Event-Listener hinzufügen
                        document.addEventListener('DOMContentLoaded', () => {
                            // Initiale Anzeige
                            updateCaloriesDisplay();

                            // Button-Klick-Listener
                            document.querySelector('.add-calories-button').addEventListener('click', () => addCalories(200));
                            document.querySelector('.reset-calories-button').addEventListener('click', resetCalories);
                        });
                    </script>






                    <div class="row">
                        <div class="col-12 col-lg-6 mb-4 mb-lg-0">                  
                            <div class="card radius-15 flex-fill h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="card-title">
                                        <h5 class="mb-0 text-center">Letzte 7 Tage</h5>
                                    </div>
                            
                                    <!-- Horizontale Tabs für die letzten 7 Tage -->
                                    <ul class="nav nav-pills nav-fill mb-4" id="pills-tab" role="tablist">
                                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link {% if loop.first %}active{% endif %}" 
                                                id="pills-{{ loop.index0 }}-tab" 
                                                data-bs-toggle="pill" 
                                                href="#pills-{{ loop.index0 }}" 
                                                role="tab" 
                                                aria-controls="pills-{{ loop.index0 }}" 
                                                aria-selected="{{ 'true' if loop.first else 'false' }}">
                                                    {{ datum }}
                                                </a>
                                            </li>
                                        {% endfor %}
                                    </ul>

                                    <!-- Inhalte für die letzten 7 Tage -->
                                    <div class="tab-content" id="pills-tabContent">
                                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                                            <div class="tab-pane fade {% if loop.first %}active show{% endif %}" 
                                                id="pills-{{ loop.index0 }}" 
                                                role="tabpanel" 
                                                aria-labelledby="pills-{{ loop.index0 }}-tab">
                                                
                                                <div class="row">
                                                    <div class="col-3">
                                                        <!-- Vertikale Tabs -->
                                                        <div class="nav flex-column nav-pills" id="v-pills-tab-{{ loop.index0 }}" role="tablist" aria-orientation="vertical">
                                                            <a class="nav-link active" 
                                                               id="v-pills-hydration-{{ loop.index0 }}-tab" 
                                                               data-bs-toggle="pill" 
                                                               href="#v-pills-hydration-{{ loop.index0 }}" 
                                                               role="tab" 
                                                               aria-controls="v-pills-hydration-{{ loop.index0 }}" 
                                                               aria-selected="true">
                                                                Hydration
                                                            </a>
                                                            <a class="nav-link" 
                                                               id="v-pills-food-{{ loop.index0 }}-tab" 
                                                               data-bs-toggle="pill" 
                                                               href="#v-pills-food-{{ loop.index0 }}" 
                                                               role="tab" 
                                                               aria-controls="v-pills-food-{{ loop.index0 }}" 
                                                               aria-selected="false">
                                                                Nahrungsmittel
                                                            </a>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-9">
                                                        <!-- Inhalte der vertikalen Tabs -->
                                                        <div class="tab-content" id="v-pills-tabContent-{{ loop.index0 }}">
                                                            <div class="tab-pane fade show active" 
                                                                 id="v-pills-hydration-{{ loop.index0 }}" 
                                                                 role="tabpanel" 
                                                                 aria-labelledby="v-pills-hydration-{{ loop.index0 }}-tab">
                                                                 {% if value.Wasser %}
                                                                    <div class="card radius-15">
                                                                        <div class="card-body">
                                                                            <div class="d-flex align-items-center">
                                                                                <div class="">
                                                                                    <h5 class="mb-0 font-weight-bold">
                                                                                        {{ value.Wasser }} {{ "Gläser" if value.Wasser > 1 else "Glas" }} Wasser von ingesamt {{ value.Wasser_GESAMT }} {{ "Gläsern" if value.Wasser_GESAMT > 1 else "Glas" }}
                                                                                    </h5>
                                                                                    <p class="mb-0">
                                                                                        Dies entspricht ca. {{ (value.Wasser * 0.5) | string | replace(".", ",") }} Liter.
                                                                                    </p>
                                                                                </div>
                                                                                <div class="ms-auto" style="position: relative;">
                                                                                    <div class="water-bottle">
                                                                                        <div class="cap">
                                                                                            <div class="cap-top"></div>
                                                                                            <div class="cap-seal"></div>
                                                                                        </div>
                                                                                        <div class="bottle">
                                                                                            <!-- Dynamische Höhe basierend auf dem Verhältnis -->
                                                                                            <div class="water-level" 
                                                                                                style="
                                                                                                    height: {{ (value.Wasser / value.Wasser_GESAMT) * 100 }}%; 
                                                                                                    margin-top: {{ 190 - ((value.Wasser / value.Wasser_GESAMT) * 190) }}px;">
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% else %}
                                                                    <p class="text-muted" style="text-align: center; font-size: 16px; margin: 20px 0;">Es wurden keine Wasserangaben erfasst.</p>
                                                                {% endif %}
                                                                 
                                                            </div>
                                                            <div class="tab-pane fade" 
                                                                id="v-pills-food-{{ loop.index0 }}" 
                                                                role="tabpanel" 
                                                                aria-labelledby="v-pills-food-{{ loop.index0 }}-tab">
                                                                <div id="food-container-{{ loop.index0 }}"></div> <!-- Container für die Karten -->
                                                            </div>
                                                            <script>
                                                                // Die Nahrungsmittel-Daten werden von Jinja2 in JS geladen
                                                                let nahrungsmittelDaten_EINZELN{{ loop.index0 }} = {{ value.Kalorien | default([]) | tojson }};

                                                                // Funktion zum Generieren der Nahrungsmittel-Daten
                                                                function generateFoodItems(tabIndex, items) {
                                                                    const container = document.getElementById(`food-container-${tabIndex}`);
                                                                    if (!container) return;

                                                                    // Prüfen, ob keine Items vorhanden sind
                                                                    if (!items || items.length === 0) {
                                                                        const noDataMessage = document.createElement('p');
                                                                        noDataMessage.className = 'text-muted'; // Optional für einen dezenten Stil
                                                                        noDataMessage.style.cssText = 'text-align: center; font-size: 16px; margin: 20px 0;';
                                                                        noDataMessage.textContent = 'Keine Nahrungsaufnahme für diesen Zeitraum erfasst.';
                                                                        container.appendChild(noDataMessage);
                                                                        return; // Keine weiteren Aktionen, wenn die Liste leer ist
                                                                    }

                                                                    items.forEach((item, index) => {
                                                                        // Karte erstellen
                                                                        const card = document.createElement('div');

                                                                        // Überprüfe, ob es das letzte Item ist
                                                                        if (index === items.length - 1) {
                                                                            card.className = "card mb-0"; // Kein Margin-Bottom für das letzte Item
                                                                        } else {
                                                                            card.className = "card mb-3"; // Margin-Bottom für alle anderen Items
                                                                        }

                                                                        card.style.cssText =
                                                                            'display: flex; align-items: center; border: 1px solid #ddd; border-radius: 10px; padding: 10px;';

                                                                        const imageDiv = document.createElement('div');
                                                                        imageDiv.style.flexShrink = '0';

                                                                        const productImage = document.createElement('img');
                                                                        productImage.src = item.images.image_url || 'https://cdn.personalpeak360.de/assets/images/Food-API/default.svg';
                                                                        productImage.alt = item.product_name || 'Produktbild';
                                                                        productImage.style.cssText = 'width: 100px; height: 100px; object-fit: cover; border-radius: 10px;';
                                                                        imageDiv.appendChild(productImage);

                                                                        const cardBody = document.createElement('div');
                                                                        cardBody.className = 'card-body';
                                                                        cardBody.style.marginLeft = '15px';

                                                                        const cardTitle = document.createElement('h5');
                                                                        cardTitle.className = 'card-title';
                                                                        cardTitle.textContent = item.product_name || 'Unbekanntes Produkt';

                                                                        const cardDescription = document.createElement('p');
                                                                        cardDescription.className = 'card-text';
                                                                        cardDescription.innerHTML = `
                                                                            Marke/n: ${item.brands || 'Unbekannt'}<br>
                                                                            Menge: ${item.quantity || 'Unbekannt'}<br>
                                                                            Kalorien: ${item.Anzahl_KALORIEN || 'Unbekannt'}
                                                                        `;

                                                                        const imageContainer = document.createElement('div');
                                                                        imageContainer.className = 'image-container';

                                                                        const nutriScoreImage = createClickableImage(
                                                                            `https://cdn.personalpeak360.de/assets/images/Food-API/NutriScore/nutriscore-${item.Scores.NutriScore || 'unknown'}-new-de.svg`
                                                                        );
                                                                        const novaScoreImage = createClickableImage(
                                                                            `https://cdn.personalpeak360.de/assets/images/Food-API/NovaScore/nova-group-${item.Scores.NovaScore || 'unknown'}.svg`
                                                                        );
                                                                        const ecoScoreImage = createClickableImage(
                                                                            `https://cdn.personalpeak360.de/assets/images/Food-API/EcoScore/ecoscore-${item.Scores.EcoScore || 'unknown'}.svg`
                                                                        );

                                                                        imageContainer.append(nutriScoreImage, novaScoreImage, ecoScoreImage);

                                                                        cardBody.append(cardTitle, cardDescription, imageContainer);
                                                                        card.append(imageDiv, cardBody);

                                                                        // Karte in den Container einfügen
                                                                        container.appendChild(card);
                                                                    });
                                                                }

                                                                // Beispielaufruf für Tab 0
                                                                generateFoodItems({{ loop.index0 }}, nahrungsmittelDaten_EINZELN{{ loop.index0 }});

                                                                // Funktion zum Erstellen eines klickbaren Bildes
                                                                function createClickableImage(src) {
                                                                    const img = document.createElement('img');
                                                                    img.src = src;
                                                                    img.style.cssText = 'width: 50px; height: 50px; object-fit: contain; margin-right: 10px; cursor: pointer;';
                                                                    return img;
                                                                }
                                                            </script>

                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>                            
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="card radius-15 flex-fill h-100">
                                <div class="card-body d-flex flex-column">
                                    <div class="card-title">
                                        <h5 class="mb-0 text-center">Verlauf</h5>
                                    </div>
                                    
                                    <ul class="nav nav-pills nav-fill mb-3" id="pills-tab" role="tablist">
                                        <li class="nav-item" role="presentation"> <a class="nav-link active" id="pills-hydration-tab" data-bs-toggle="pill" href="#pills-hydration" role="tab" aria-controls="pills-hydration" aria-selected="true">Hydration</a>
                                        </li>
                                        <li class="nav-item" role="presentation"> <a class="nav-link" id="pills-nahrungsmittel-tab" data-bs-toggle="pill" href="#pills-nahrungsmittel" role="tab" aria-controls="pills-nahrungsmittel" aria-selected="false">Nahrungsmittel</a>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="pills-tabContent">
                                        <div class="tab-pane fade active show" id="pills-hydration" role="tabpanel" aria-labelledby="pills-hydration-tab">
                                            <div id="CHART_VERLAUF_Hydration" style="min-height: 365px;"></div>
                                        </div>
                                        <div class="tab-pane fade" id="pills-nahrungsmittel" role="tabpanel" aria-labelledby="pills-nahrungsmittel-tab">
                                            <div id="CHART_VERLAUF_Nahrungsmittel" style="min-height: 365px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    

                    
                    
                    <style>
                        .bottle { background: #eee; width:100px;border-radius:30px 30px 6px 6px; height:200px; padding:6px;box-shadow: 2px  2px 2px #efefef;;margin-bottom:4px;}
                
                        .cap {background: #ddd;margin:0 25px;width: 50px;border-radius:8px 8px 10px  12px;height:35px;border-top:1px solid #ddd;border-bottom:2px dotted #efefef;}
                        .cap-top { background:#ededed; height:6px; border-radius:10px 10px 0 0; }
                        .cap-seal { margin-top:20px;background:#ccc; height:6px; border-radius: 0 0 10px 10px; }
                
                        .water-level {background: lightblue;width: 90px;margin-top: 180px;height:10px;border-radius:28px 28px 10px 10px;transition: 0.2s;}
                        .water-bottle{
                            justify-content: center;
                            display: grid;
                            align-items: center;
                        }
                
                        .water-handler{
                            position: relative;
                            min-height: 400px;
                        }
                
                        .texter {
                            text-align: center;
                            overflow: hidden;
                            position: absolute;
                            border: 2px solid #f80;
                            color: #f80;
                            border-radius: 10px;
                            width: 100%;
                            bottom: 0;
                        }
                
                        .texter p {
                            font-size: 30px;
                            color: #fff;
                            background: #f80;
                            margin: 0;
                        }
                
                        .texter button {
                            width: 100%;
                            border: 0;
                            display: ruby-text;
                            background: transparent;
                            margin-bottom: 10px;
                        }
                
                        .texter button span {
                            border: 2px solid;
                            width: 50px;
                            border-radius: 50%;
                            height: 50px;
                            font-size: 20px;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            transition: 0.2s;
                        }
                
                        .texter button span:hover {
                            color: #fff;
                            font-size: 25px;
                            background: #f80;
                        }
                
                        .pyramid-search {
                            position: relative;
                        }
                
                        .pyramid-search button {
                            position: absolute;
                            right: 0;
                            top: 0;
                            height: 100%;
                            width: 50px;
                            border: 0;
                            background: #f80;
                            color: white;
                            transition: 0.2s;
                        }
                
                        .pyramid-search button:hover {
                            background: #f70;
                            width: 55px;
                        }
                        .additional-tools {
                            position: fixed;
                            top: 200px;
                            z-index: 1000;
                            left: 0;
                        }
                
                        .additional-tools ul {
                            margin: 0;
                            background: #d6eeff;
                            list-style: none;
                            padding: 0;
                        }
                
                        .additional-tools ul li {
                            padding: 10px 15px;
                            cursor: pointer;
                        }
                
                        .additional-tools ul li:hover {
                            background: #c1e5ff;
                        }
                
                        .btn-container  ul {
                            background: #2b3e50;
                            color: white;
                            margin: auto;
                            padding: 0;
                            list-style: none;
                            width: fit-content;
                            text-align: center;
                            font-weight: 700;
                            font-weight: 500;
                        }
                
                        .btn-container  ul li {
                            display: inline-block;
                            padding: 15px 20px;
                            margin: 0;
                            border-top: 2px solid transparent;
                            cursor: pointer;
                            user-select: none;
                            transition: 0.2s;
                        }
                
                        .btn-container  ul li:hover {
                            background: #141d26;
                        }
                
                        .btn-container  ul li.active {
                            border-color: #ffb63b;
                            background: #141d26;
                            color: #ffb63b;
                        }
                        .fc .fc-daygrid-day-frame{
                            cursor: pointer;
                        }
                        .fc .fc-daygrid-day-frame:hover{
                            background: #f3f3f3;
                        }
                
                        .fc-license-message{
                            display: none !important;
                        }
                        .calendar-section {
                            position: relative;
                        }
                
                        .highlighted-date {
                            background: linear-gradient(45deg, #ffffb9, #c6ffc6);
                        }
                
                        button.vote {
                            border: 2px solid;
                            border-radius: 5px;
                            padding: 10px;
                            transition: 0.2s;
                            background: transparent;
                            outline: 0;
                        }
                
                        button.vote.downvote {
                            color: red;
                        }
                
                        button.vote.upvote {
                            color: green;
                        }
                
                        button.vote.upvote:hover {
                            background: green;
                            color: white;
                        }
                
                        button.vote.downvote:hover {
                            color: white;
                            background: red;
                        }
                
                        button.vote.btn-danger-glow {
                            box-shadow: 0 0 20px red;
                            border-color: red;
                            background: red;
                            color: white;
                            animation: 2s blowShadowR infinite;
                        }
                
                        button.vote.btn-success-glow {
                            box-shadow: 0 0 20px green;
                            border-color: green;
                            background: green;
                            color: white;
                            animation: 2s blowShadowS infinite;
                        }
                        @keyframes blowShadowS{
                            0%,100%{
                                box-shadow: 0 0 20px 0 green;
                            }
                            50%{
                                box-shadow: 0 0 20px 2px green;
                            }
                        }
                        @keyframes blowShadowR{
                            0%,100%{
                                box-shadow: 0 0 20px 0 red;
                            }
                            50%{
                                box-shadow: 0 0 20px 2px red;
                            }
                        }
                        td{
                            vertical-align: middle;
                        }
                        .cal-img {
                            position: relative;
                            text-align: center;
                        }
                
                        .score-overlay {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            backdrop-filter: grayscale(1);
                            transition: 0.5s;
                            height: 100%; /* Standardhöhe */
                        }
                
                        .calorimeter {
                            background: linear-gradient(45deg, #ffa600, red);
                            border-radius: 10px;
                            color: white;
                        }
                
                        .calories-count {
                            margin: 20px 0;
                            display: inline-block;
                        }
                
                        .calories-count h2 {
                            background: linear-gradient(45deg, #ff7900, #ff0b00);
                            height: 200px;
                            width: 200px;
                            border-radius: 50%;
                            font-size: 5rem;
                            box-shadow: 0 0 5px 0 #09000061;
                        }
                
                        .score-overlay-ver {
                            position: absolute;
                            width: 10px;
                            background: linear-gradient(0, red, #ff8000);
                            bottom: 20%;
                            z-index: 100;
                            right: 10px;
                            transition: 0.5s;
                        }
                
                        .score-overlay-ver:before {
                            content: " ";
                            position: absolute;
                            width: 100px;
                            right: 0;
                            padding: 0;
                            border-top: 2px solid black;
                        }
                
                        .search-output .item-list {
                            background: white;
                            margin: 2px 0;
                            cursor: pointer;
                            border-bottom: 1px solid #f3f3f3;
                        }
                
                        .search-output .item-list:hover {
                            background: #f1f1f1;
                        }
                
                        .search-output {
                            max-height: 400px;
                            overflow-y: scroll;
                        }
                
                        b{
                            padding: 0 !important;
                        }
                
                        .tbl-ctr{
                            white-space: nowrap;
                        }
                        .robot-navigator {
                            left: 20px;
                            top:31%;
                            right: unset;
                        }
                    </style>

                </div>
            </div>
            <!--end page-content-wrapper-->
        </div>
        <!--end page-wrapper-->

		<!--start overlay-->
		<div class="overlay toggle-btn-mobile"></div>
		<!--end overlay-->
		<!--Start Back To Top Button--> <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
		<!--End Back To Top Button-->
		
        {{ footer | safe }}

	</div>
	<!-- end wrapper -->
	
    {{ theme_customizer | safe }}
    
	<!-- JavaScript -->
	<!-- Bootstrap JS -->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/bootstrap.bundle.min.js"></script>
	
	<!--plugins-->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/jquery.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/metismenu/js/metisMenu.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flipdown/dist/flipdown.min.js"></script>

    <script src="https://cdn.personalpeak360.de/syndash/assets/plugins/apexcharts-bundle/js/apexcharts.min.js"></script>
    <script>
        var options = {
            series: [
                {
                    name: 'Ziel (Gläser)',
                    type: 'line', // Typ kann 'line' oder 'column' sein
                    data: [
                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                            {% if value['Wasser_GESAMT'] %}
                                {{ value['Wasser_GESAMT'] }}{% if not loop.last %},{% endif %}
                            {% else %}
                                0{% if not loop.last %},{% endif %}
                            {% endif %}
                        {% endfor %}
                    ]
                },
                {
                    name: 'Erreicht (Gläser)',
                    type: 'column', // Typ kann 'line' oder 'column' sein
                    data: [
                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                            {% if value['Wasser'] %}
                                {{ value['Wasser'] }}{% if not loop.last %},{% endif %}
                            {% else %}
                                0{% if not loop.last %},{% endif %}
                            {% endif %}
                        {% endfor %}
                    ]
                }
            ],
            chart: {
                foreColor: '#9ba7b2',
                height: 350,
                type: 'line', // Bleibt 'line', da gemischte Typen verwendet werden
                stacked: false,
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            colors: ["#673ab7", "#198fed"], // Farben für Ziel und Erreicht
            stroke: {
                width: [2, 0], // Breite der Linien
                curve: 'smooth' // Glatte Kurven
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%' // Breite der Balken
                }
            },
            fill: {
                opacity: [1, 0.85], // Opazität
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            labels: [
                {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                    '{{ datum | format_date_custom }}'{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            markers: {
                size: 5 // Größe der Markierungen auf der Linie
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    formatter: function (value) {
                        // Datumsformatierung ins Deutsche (z. B. 9. Dezember)
                        const date = new Date(value);
                        const options = { day: 'numeric', month: 'short' };
                        return date.toLocaleDateString('de-DE', options); // "de-DE" für Deutsch
                    }
                }
            },
            yaxis: {
                title: {
                    text: 'Anzahl der Gläser'
                },
                min: 0,
                max: 10 // Maximale Anzahl der Gläser
            },
            tooltip: {
                shared: true,
                intersect: false,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(0) + " Gläser (" + (y.toFixed(0) * 0.5).toString().replace('.', ',') + " Liter)";
                        }
                        return y;
                    }
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#CHART_VERLAUF_Hydration"), options);
        chart.render();
    </script>

    <script>
        var options = {
            series: [
                {
                    name: 'Ziel (kcal)',
                    type: 'line', // Typ kann 'line' oder 'column' sein
                    data: [
                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                            {% if value['Kalorien_INFO'] %}
                                {{ value['Kalorien_INFO']['Ziel'] }}{% if not loop.last %},{% endif %}
                            {% else %}
                                0{% if not loop.last %},{% endif %}
                            {% endif %}
                        {% endfor %}
                    ]
                },
                {
                    name: 'Erreicht (kcal)',
                    type: 'column', // Typ kann 'line' oder 'column' sein
                    data: [
                        {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                            {% if value['Kalorien_INFO'] %}
                                {{ value['Kalorien_INFO']['Erreicht'] }}{% if not loop.last %},{% endif %}
                            {% else %}
                                0{% if not loop.last %},{% endif %}
                            {% endif %}
                        {% endfor %}
                    ]
                }
            ],
            chart: {
                foreColor: '#9ba7b2',
                height: 350,
                type: 'line', // Bleibt 'line', da gemischte Typen verwendet werden
                stacked: false,
                zoom: {
                    enabled: false
                },
                toolbar: {
                    show: true
                }
            },
            colors: ["#673ab7", "#198fed"], // Farben für Ziel und Erreicht
            stroke: {
                width: [2, 0], // Breite der Linien
                curve: 'smooth' // Glatte Kurven
            },
            plotOptions: {
                bar: {
                    columnWidth: '50%' // Breite der Balken
                }
            },
            fill: {
                opacity: [1, 0.85], // Opazität
                gradient: {
                    inverseColors: false,
                    shade: 'light',
                    type: "vertical",
                    opacityFrom: 0.85,
                    opacityTo: 0.55,
                    stops: [0, 100, 100, 100]
                }
            },
            labels: [
                {% for datum, value in Letzte7Tage_TRACKING_DATEN.items() %}
                    '{{ datum | format_date_custom }}'{% if not loop.last %},{% endif %}
                {% endfor %}
            ],
            markers: {
                size: 5 // Größe der Markierungen auf der Linie
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    formatter: function (value) {
                        // Datumsformatierung ins Deutsche (z. B. 9. Dezember)
                        const date = new Date(value);
                        const options = { day: 'numeric', month: 'short' };
                        return date.toLocaleDateString('de-DE', options); // "de-DE" für Deutsch
                    }
                }
            },
            yaxis: {
                title: {
                    text: 'Kalorien'
                },
                min: 0,
                max: undefined  // Maximale Anzahl der Gläser
            },
            tooltip: {
                shared: true,
                intersect: false,
                y: {
                    formatter: function (y) {
                        if (typeof y !== "undefined") {
                            return y.toFixed(0) + " kcal";
                        }
                        return y;
                    }
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#CHART_VERLAUF_Nahrungsmittel"), options);
        chart.render();
    </script>
    
	<!--Data Tables js-->
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
	<script>
		$(document).ready(function () {
			//Default data table
			$('#example').DataTable();
			var table = $('#example2').DataTable({
				lengthChange: false,
				buttons: ['copy', 'excel', 'pdf', 'print', 'colvis']
			});
			table.buttons().container().appendTo('#example2_wrapper .col-md-6:eq(0)');
		});
	</script>
	<!-- App JS -->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/app.js"></script>


	<script>
		new Vue({
			el: '#app',
			data: {
				error: "{{ error }}",
				success: "{{ success }}",
				punkte: "{{ punkte_nachricht }}"
			},
			methods: {
				showMessages() {
					if (this.isErrorVisible) {
						this.showError();
					}
					if (this.isSuccessVisible) {
						this.showSuccess();
					}
					if (this.isPunkteVisible) {
						this.showPunkte();
					}
				},
				showError() {
					// Create an instance of Notyf
					var message = new nachricht_func({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display an error notification
					message.error('{{ error }}');
				},
				showSuccess() {
					// Create an instance of Notyf
					var message = new nachricht_func({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display a success notification
					message.success('{{ success }}');
				},
				showPunkte() {
					// Create an instance of Notyf
					var message = new nachricht_func({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display points notification
					message.success('{{ punkte }}'); // or use message.error() if it should be an error
				}
			},
			computed: {
				isErrorVisible: function () {
					return this.error && this.error !== '' && this.error !== 'None';
				},
				isSuccessVisible: function() {
					return this.success && this.success !== '' && this.success !== 'None';
				},
				isPunkteVisible: function() {
					return this.punkte && this.punkte !== '' && this.punkte !== 'None';
				}
			},
			watch: {
				isErrorVisible(newVal) {
					if (!newVal) {
						this.closeError();
					}
				},
				isSuccessVisible(newVal) {
					if (!newVal) {
						this.closeSuccess();
					}
				},
				isPunkteVisible(newVal) {
					if (!newVal) {
						this.closePunkte(); // You can implement this method if needed
					}
				}
			},
			created() {
				this.$nextTick(() => {
					this.showMessages();
				})
			}
		});
	</script>	
</body>

</html>