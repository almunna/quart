<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<title>{{ WhiteLabel['Bezeichnung'] }} | Upload & Analyse → Trainingshalle</title>
	<!--favicon-->
	<link rel="icon" href="https://cdn.personalpeak360.de/white-label/{{ WhiteLabel['Favicon'] }}" type="image/png">
	<!--plugins-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flipdown/dist/flipdown.min.css">
	<!--Data Tables -->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
	<!--plugins-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/fullcalendar/css/main.min.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
	<link href="https://cdn.personalpeak360.de/syndash/assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
	<!-- loader-->
	<link href="https://cdn.personalpeak360.de/syndash/assets/css/pace.min.css" rel="stylesheet" />
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/pace.min.js"></script>
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&family=Roboto&display=swap" />
	<!-- Icons CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/icons.css" />
	<!-- App CSS -->
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/app.css" />
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/dark-sidebar.css" />
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/syndash/assets/css/dark-theme.css" />

	<script src="https://cdn.personalpeak360.de/assets/custom/benachrichtigung/benachrichtigung.js"></script>
	<link rel="stylesheet" href="https://cdn.personalpeak360.de/assets/custom/benachrichtigung/benachrichtigung.css">
	<script src="https://cdn.personalpeak360.de/assets/vendor/js/vue.js"></script>
</head>

<body>
	<!-- wrapper -->
	<div class="wrapper">
		<!--sidebar-wrapper-->
		{{ sidebar | safe }}
		<!--end sidebar-wrapper-->
		
		{{ header | safe }}


		<!--page-wrapper-->
        <div class="page-wrapper">
            <!--page-content-wrapper-->
            <div class="page-content-wrapper">
                <div class="page-content">
					{% if Trainingshalle_Details['Letzter_FitnessTest']['Status'] != "Abgeschlossen" and Trainingshalle_Details['Letzter_FitnessTest']['Status'] != "Keine Daten verfügbar" %}
						<div class="alert alert-info alert-dismissible text-center" role="alert" id="trainings-info">
							<h4 class="alert-heading" id="trainings-title">Trainingsplan wird erstellt!</h4>
							<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							<p id="trainings-description">Dein Trainingsplan wird gerade erstellt. Bitte habe einen Moment Geduld, während wir alle relevanten Daten analysieren und deinen individuellen Plan zusammenstellen.</p>
							<div style="display: block; margin-left: auto; margin-right: auto; width: fit-content;" id="flipdown2" class="flipdown"></div>
							<hr>
							<p class="mb-0" id="trainings-footer">In der Zwischenzeit hast du eingeschränkten Zugriff auf die Trainingshalle. Einige Funktionen stehen dir erst nach Abschluss der Erstellung deines individuellen Trainingsplans zur Verfügung.</p>
						</div>

						<script>
							document.addEventListener("DOMContentLoaded", function () {
								// Überprüfen, ob das Ziel-Element existiert
								const flipdownElement = document.getElementById('flipdown2');
								if (!flipdownElement) {
									console.error('FlipDown element not found!');
									return;
								}

								// Zeitstempel aus Jinja2 (ISO-Format)
								var timestamp = "{{ Trainingshalle_Details['Letzter_FitnessTest']['Daten']['Zeitstempel'] }}";
								if (!timestamp) {
									console.error('Zeitstempel fehlt!');
									return;
								}

								// Konvertiere das Ziel-Datum in einen Unix-Zeitstempel (in Sekunden)
								var currentDate = Math.floor(new Date(timestamp).getTime() / 1000);

								// 48 Stunden in Sekunden
								var hours48 = 48 * 60 * 60;

								// Ziel-Datum (heute + 48 Stunden)
								var targetDate = currentDate + hours48;

								// FlipDown initialisieren
								var flipdown = new FlipDown(targetDate, 'flipdown2', {
									headings: ["Tage", "Stunden", "Minuten", "Sekunden"]
								})
									// Countdown starten
									.start()
									// Funktion ausführen, wenn der Countdown endet
									.ifEnded(() => {
										console.log('Der Countdown ist abgelaufen!');

										// Ändere den Inhalt der Meldung
										const infoContainer = document.getElementById('trainings-info');
										infoContainer.classList.remove('alert-info');
										infoContainer.classList.add('alert-warning');

										document.getElementById('trainings-title').textContent = 'Dein Trainingsplan verzögert sich!';
										document.getElementById('trainings-description').textContent =
											'Leider ist dein Trainer derzeit im Verzug. Dies kann verschiedene Gründe haben, wie eine unerwartete Arbeitslast oder technische Probleme.';
										document.getElementById('flipdown2').style.display = 'none'; // Verberge den Countdown
										document.getElementById('trainings-footer').textContent =
											'Bitte setze dich mit deinem Trainer in Verbindung, um weitere Informationen zu erhalten.';
									});
							});
						</script>
					{% endif %}

                    
                    <div class="card radius-15 mb-3">
                        <div class="card-body">
                            <div class="card-title">
                                <h4 class="mb-0">Upload und Analyse</h4>
                                <h6 class="mb-0">Auf dieser Seite kannst Du Videos an Deinen Trainer schicken, welcher Dir dann darauf per Video oder in Schriftform Feedback gibt.</h6>
                                <h6 class="mb-0">Dies kannst Du z.B. nutzen um Feedback zur Ausführung einer bestimmten Übung zu bekommen.</h6>
                            </div>
							<hr/>
							<!-- Button trigger modal -->
							<button type="button" class="btn btn-primary mb-0" data-bs-toggle="modal" data-bs-target="#AnalyseAnfordern">Neue Analyse anfordern</button>

							<!-- Modal -->
							<div class="modal fade" id="AnalyseAnfordern" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <form action="https://dashboard.{{ WhiteLabel['Domain'] }}/trainingshalle/Upload-Analyse" method="post" id="Erstellen_FORM" enctype="multipart/form-data">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Neue Analyse anfordern</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body" style="word-wrap: break-word; white-space: normal;">
												<div class="alert alert-info" role="alert">
													<h4 class="alert-heading">Kameraanleitung für Übungen</h4>
													<ol>
														<li>
															<b>Positioniere die Kamera seitlich</b>: Stelle sicher, dass die Kamera auf Körperhöhe und seitlich von dir positioniert ist, um eine klare Sicht auf deine Bewegungen zu haben.
														</li>
														<li>
															<b>Ganzer Körper im Bild</b>: Achte darauf, dass dein ganzer Körper von Kopf bis Fuß im Bild zu sehen ist.
														</li>
														<li>
															<b>Stabiler Stand</b>: Verwende ein Stativ oder eine stabile Unterlage, um Wackeln zu vermeiden.
														</li>
														<li>
															<b>Gutes Licht</b>: Sorge für ausreichend Beleuchtung, damit alle Bewegungen deutlich erkennbar sind.
														</li>
														<li>
															<b>Unverdeckte Sicht</b>: Stelle sicher, dass keine Gegenstände dich oder wichtige Teile deiner Bewegung verdecken.
														</li>
													</ol>
													<p class="mb-0">Starte die Aufnahme vor Beginn der Übung und beende sie nach Abschluss. So kann der Trainer deine gesamte Bewegung analysieren.</p>
												</div>

												<div class="form-group mb-3">
													<label for="Video">Video hochladen</label>
													<input type="file" class="form-control" name="Video" id="Video" accept="video/mp4, video/avi, video/mov, video/x-matroska, video/*">
												</div>

												<div class="form-group mb-3">
													<label for="Nachricht">Nachricht an Deinen Trainer</label>
													<textarea class="form-control" name="Nachricht" id="Nachricht" placeholder="Bitte gib mir Feedback zu der Ausführung der Liegestütze."></textarea>
												</div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                                <button type="submit" class="btn btn-primary">Übung anlegen</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
							</div>
                        </div>
                    </div>

                    <style>
						.yellow-dot {
							color: var(--primary-color) !important; /* Die Farbe des Punktes auf Gelb setzen */
							font-size: 1.5em; /* Die Größe des Punktes anpassen, falls nötig */
						}

						.exercise-textarea {
							width: 100%;
							max-width: 640px;
							height: 200px;
							font-size: 1em;
							line-height: 1.5;
							padding: 10px;
							border: 1px solid #ccc;
							border-radius: 10px;
							resize: none;
							background-color: #f9f9f9;
							color: #333;
						}
					</style>

					<script>
						document.addEventListener("DOMContentLoaded", function () {
							const cards = document.querySelectorAll(".trainingshalle .card");
							const exerciseDetails = document.querySelector(".exercise-details");
							const exerciseInfo = exerciseDetails ? exerciseDetails.querySelector(".exercise-info") : null;
							const loadingSpinner = document.getElementById('loading-spinner');

							if (!exerciseInfo) {
								console.error("Element 'exercise-info' nicht gefunden.");
								return;
							}

							const exerciseName = exerciseInfo.querySelector("h4");
							const exerciseVideo = exerciseInfo.querySelector(".exercise-video video");
							const exerciseText = exerciseInfo.querySelector(".exercise-textarea");


							if (!exerciseName || !exerciseVideo || !exerciseText) {
								console.error("Ein oder mehrere Elemente wurden nicht gefunden.");
								return;
							}

							cards.forEach(card => {
								card.addEventListener("click", () => {
									loadingSpinner.classList.remove('d-none');

									const name = card.getAttribute("data-name");
									const video = card.getAttribute("data-video");
									const text = card.getAttribute("data-text");

									// Übungsdetails aktualisieren
									exerciseName.innerHTML = '<span class="yellow-dot">•</span> ' + name + ' <span class="yellow-dot">•</span>';
									exerciseVideo.setAttribute("src", 'https://cdn.personalpeak360.de/trainingshalle/' + video);
									exerciseText.value = text;


									// Ladeereignisse hinzufügen
									let videoLoaded = false;
									let audioLoaded = false;

									exerciseVideo.onloadeddata = () => {
										videoLoaded = true;
										checkIfLoaded();
									};

									// Funktion zum Überprüfen, ob beide Ressourcen geladen sind
									function checkIfLoaded() {
										if (videoLoaded) {
											loadingSpinner.classList.add('d-none'); // Spinner ausblenden
										}
									}

									// Zeige die Übungsdetails an
									exerciseDetails.querySelector("p").classList.add("d-none");
									exerciseInfo.classList.remove("d-none");
								});
							});
						});
					</script>



					<script>
						document.addEventListener('languageChanged', function(e) {
							const { langCode, flagCode } = e.detail;
							console.log(`Die Sprache wurde zu ${langCode} (${flagCode}) geändert!!!`);

							// Hier kannst du deine eigene Funktion aufrufen, die nach der Sprachänderung ausgeführt wird
							performSearch(currentPage);
						});


						
						////////////////////////////////
						// RENDERN DER SUCHERGEBNISSE //
						////////////////////////////////
						
						// RENDERN DER SUCHERGEBNISSE
						document.addEventListener('DOMContentLoaded', function() {
							// Füge den Event-Listener für den Suchbutton und die Enter-Taste hinzu
							const searchButton = document.getElementById('button-suche');
							const searchBar = document.getElementById('search-bar');
							const loadingSpinner = document.getElementById('loading-spinner');
							const loadingSpinnerBackground = document.getElementById('loading-spinnerBackground');
							
							const exerciseDetails = document.querySelector(".exercise-details");
							const exerciseInfo = exerciseDetails ? exerciseDetails.querySelector(".exercise-info") : null;

							if (!exerciseInfo) {
								console.error("Element 'exercise-info' nicht gefunden.");
								return;
							}

							const trainingshalle = document.querySelector('.trainingshalle div');
							const paginationContainer = document.querySelector('.pagination.round-pagination'); // Verweis auf deine Paginierung

							if (!paginationContainer) {
								console.error("Element 'pagination' nicht gefunden.");
								return;
							}

							const exerciseName = exerciseInfo.querySelector("h4");
							const exerciseVideo = exerciseInfo.querySelector(".exercise-video video");
							const exerciseText = exerciseInfo.querySelector(".exercise-textarea");

							
							const antwortVideo = exerciseInfo.querySelector(".antwort-video video");
							const antwortText = exerciseInfo.querySelector(".antwort-textarea");


							if (!exerciseName || !exerciseVideo || !exerciseText) {
								console.error("Ein oder mehrere Elemente wurden nicht gefunden.");
								return;
							}

							let currentPage = 1;
							let totalPages = 1;

							// Funktion zum Ausführen der Suche
							const performSearch = (page = 1) => {
								if (typeof page !== 'number') {
									console.error("Page-Parameter ist keine Zahl:", page);
									return;
								}

								trainingshalle.innerHTML = ''; // Alte Inhalte löschen
								const searchValue = searchBar.value;
								const url = `https://dashboard.personalpeak360.de/trainingshalle/Upload-Analyse?Art=Suche&Typ=Meine&SUCHE_Name=${encodeURIComponent(searchValue)}&SEITE=${page}`;

								console.log(url)

								// Ladeanimation anzeigen
								loadingSpinner.classList.remove('d-none');
								loadingSpinnerBackground.classList.remove('d-none');

								// Führe die POST-Anfrage aus
								fetch(url, {
									method: 'POST'
								})
								.then(response => response.json())
								.then(data => {
									trainingshalle.innerHTML = ''; // Alte Inhalte löschen
									totalPages = data.Seiten; // Die Zuweisung erfolgt jetzt innerhalb des `then`-Blocks

									if (data.Seiten_Inhalt.length > 0) {
										data.Seiten_Inhalt.forEach(übung => {
											const card = document.createElement('div');
											card.className = 'card bg-dark radius-15 mb-1';
											card.style.cursor = 'pointer';

											// Funktion zur Formatierung des Datums
											function formatDate(dateString) {
												const date = new Date(dateString);

												const day = String(date.getDate()).padStart(2, '0'); // Tag mit führender Null
												const month = String(date.getMonth() + 1).padStart(2, '0'); // Monat mit führender Null (Monate beginnen bei 0)
												const year = date.getFullYear(); // Jahr
												const hours = String(date.getHours()).padStart(2, '0'); // Stunden mit führender Null
												const minutes = String(date.getMinutes()).padStart(2, '0'); // Minuten mit führender Null

												// Datum im gewünschten Format zurückgeben
												return `Anfrage vom ${day}.${month}.${year} um ${hours}:${minutes} Uhr`;
											}

											card.dataset.name = formatDate(übung.date_created);;
											card.dataset.video = übung.Video;
											card.dataset.text = übung.Nachricht;

											if (übung.Status == "Abgeschlossen" && übung.Antwort && übung.Antwort_Details) {
												card.dataset.antwort_video = übung.Antwort_Details.Video;
												card.dataset.antwort_text = übung.Antwort_Details.Nachricht;
											}

											const cardBody = document.createElement('div');
											cardBody.className = 'card-body';

											const cardText = document.createElement('p');
											cardText.className = 'card-text text-white';
											cardText.textContent = card.dataset.name;

											cardBody.appendChild(cardText);
											card.appendChild(cardBody);
											trainingshalle.appendChild(card);

											// Click-Event-Listener für die Karten hinzufügen
											card.addEventListener('click', () => {
												const name = card.getAttribute("data-name");
												const video = card.getAttribute("data-video");
												const text = card.getAttribute("data-text");

												
												const antwort_video = card.getAttribute("data-antwort_video");
												const antwort_text = card.getAttribute("data-antwort_text");



												// Ladeanimation anzeigen
												loadingSpinner.classList.remove("d-none");
												loadingSpinnerBackground.classList.remove("d-none");

												// Übungsdetails aktualisieren
												exerciseName.innerHTML = `<span class="yellow-dot">•</span> ${card.dataset.name} <span class="yellow-dot">•</span>`;
												exerciseVideo.setAttribute("src", `https://cdn.personalpeak360.de/trainingshalle/${card.dataset.video}`);

												// Textinhalte aktualisieren
												exerciseText.value = card.dataset.text

												
												if (card.dataset.antwort_video && card.dataset.antwort_text) {
													document.getElementById('Div-Antwort_TRAINER').style.display = 'block';
													// Antwort ausfüllen
													antwortVideo.setAttribute("src", `https://cdn.personalpeak360.de/trainingshalle/${card.dataset.antwort_video}`);
													antwortText.value = card.dataset.antwort_text
												}

												// Zeige die Übungsdetails an
												exerciseDetails.querySelector("p").classList.add("d-none");
												exerciseInfo.classList.remove("d-none");

												// Warte, bis sowohl Video als auch Audio geladen sind
												let videoLoaded = false;

												// Funktion zum Überprüfen, ob beide Ressourcen geladen sind
												const checkIfLoaded = () => {
													if (videoLoaded) {
														loadingSpinner.classList.add("d-none");
														loadingSpinnerBackground.classList.add("d-none");
													}
												};

												// Ladeereignis für das Video
												exerciseVideo.onloadeddata = () => {
													videoLoaded = true;
													checkIfLoaded();
												};
											});
										});

										// Paginierung aktualisieren
										updatePagination();
										loadingSpinner.classList.add('d-none');
										loadingSpinnerBackground.classList.add('d-none');
									} else {
										loadingSpinner.classList.add('d-none');
										loadingSpinnerBackground.classList.add('d-none');

										const noResults = document.createElement('p');
										noResults.className = 'text-center text-muted';
										noResults.textContent = 'Keine Anfragen gefunden.';
										trainingshalle.appendChild(noResults);
									}
								})
								.catch(error => {
									console.error('Fehler bei der Suchanfrage:', error);
								});
							};

							

							const updatePagination = () => {
								paginationContainer.innerHTML = ''; // Alte Paginierung löschen

								const prevPageItem = document.createElement('li');
								prevPageItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
								const prevLink = document.createElement('a');
								prevLink.className = 'page-link';
								prevLink.href = 'javascript:;';
								prevLink.textContent = 'Zurück';
								prevLink.addEventListener('click', () => {
									if (currentPage > 1) {
										currentPage--;
										performSearch(currentPage); // Korrekt: Zahl übergeben
									}
								});
								prevPageItem.appendChild(prevLink);
								paginationContainer.appendChild(prevPageItem);

								for (let i = 1; i <= totalPages; i++) {
									const pageItem = document.createElement('li');
									pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
									const pageLink = document.createElement('a');
									pageLink.className = 'page-link';
									pageLink.href = 'javascript:;';
									pageLink.textContent = i;
									pageLink.addEventListener('click', () => {
										currentPage = i;
										performSearch(currentPage); // Korrekt: Zahl übergeben
									});
									pageItem.appendChild(pageLink);
									paginationContainer.appendChild(pageItem);
								}

								const nextPageItem = document.createElement('li');
								nextPageItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
								const nextLink = document.createElement('a');
								nextLink.className = 'page-link';
								nextLink.href = 'javascript:;';
								nextLink.textContent = 'Weiter';
								nextLink.addEventListener('click', () => {
									if (currentPage < totalPages) {
										currentPage++;
										performSearch(currentPage); // Korrekt: Zahl übergeben
									}
								});
								nextPageItem.appendChild(nextLink);
								paginationContainer.appendChild(nextPageItem);
							};
							
							if (searchButton) {
								searchButton.addEventListener('click', () => performSearch(1));
							}


							if (searchBar) {
								searchBar.addEventListener('keypress', function(event) {
									if (event.key === 'Enter') {
										performSearch(1);
									}
								});
							}

							// Führe die Suche beim Laden der Seite aus
							performSearch(1);



							
							// Füge den Event-Listener für den Suchbutton und die Enter-Taste hinzu
							const searchButton_TRAINER = document.getElementById('button-suche_TRAINER');
							const searchBar_TRAINER = document.getElementById('search-bar_TRAINER');

							if (!exerciseInfo) {
								console.error("Element 'exercise-info' nicht gefunden.");
								return;
							}

							if (!paginationContainer) {
								console.error("Element 'pagination' nicht gefunden.");
								return;
							}
							if (!exerciseName || !exerciseVideo || !exerciseText) {
								console.error("Ein oder mehrere Elemente wurden nicht gefunden.");
								return;
							}

							// Funktion zum Ausführen der Suche
							const performSearch_TRAINER = (page = 1) => {
								if (typeof page !== 'number') {
									console.error("Page-Parameter ist keine Zahl:", page);
									return;
								}

								trainingshalle.innerHTML = ''; // Alte Inhalte löschen
								const searchValue = searchBar_TRAINER.value;
								const url = `https://dashboard.personalpeak360.de/trainingshalle/Upload-Analyse?Art=Suche&Typ=Trainer&SUCHE_Name=${encodeURIComponent(searchValue)}&SEITE=${page}`;

								console.log(url)

								// Ladeanimation anzeigen
								loadingSpinner.classList.remove('d-none');
								loadingSpinnerBackground.classList.remove('d-none');

								document.getElementById('Div-Antwort_TRAINER').style.display = 'None';

								// Führe die POST-Anfrage aus
								fetch(url, {
									method: 'POST'
								})
								.then(response => response.json())
								.then(data => {
									trainingshalle.innerHTML = ''; // Alte Inhalte löschen
									totalPages = data.Seiten; // Die Zuweisung erfolgt jetzt innerhalb des `then`-Blocks

									if (data.Seiten_Inhalt.length > 0) {
										data.Seiten_Inhalt.forEach(übung => {
											const card = document.createElement('div');
											card.className = 'card bg-dark radius-15 mb-1';
											card.style.cursor = 'pointer';

											// Funktion zur Formatierung des Datums
											function formatDate(dateString) {
												const date = new Date(dateString);

												const day = String(date.getDate()).padStart(2, '0'); // Tag mit führender Null
												const month = String(date.getMonth() + 1).padStart(2, '0'); // Monat mit führender Null (Monate beginnen bei 0)
												const year = date.getFullYear(); // Jahr
												const hours = String(date.getHours()).padStart(2, '0'); // Stunden mit führender Null
												const minutes = String(date.getMinutes()).padStart(2, '0'); // Minuten mit führender Null

												// Datum im gewünschten Format zurückgeben
												return `Antwort vom ${day}.${month}.${year} um ${hours}:${minutes} Uhr`;
											}

											card.dataset.name = formatDate(übung.date_created);;
											card.dataset.video = übung.Video;
											card.dataset.text = übung.Nachricht;

											const cardBody = document.createElement('div');
											cardBody.className = 'card-body';

											const cardText = document.createElement('p');
											cardText.className = 'card-text text-white';
											cardText.textContent = card.dataset.name;

											cardBody.appendChild(cardText);
											card.appendChild(cardBody);
											trainingshalle.appendChild(card);

											// Click-Event-Listener für die Karten hinzufügen
											card.addEventListener('click', () => {
												const name = card.getAttribute("data-name");
												const video = card.getAttribute("data-video");
												const text = card.getAttribute("data-text");

												// Ladeanimation anzeigen
												loadingSpinner.classList.remove("d-none");
												loadingSpinnerBackground.classList.remove("d-none");

												// Übungsdetails aktualisieren
												exerciseName.innerHTML = `<span class="yellow-dot">•</span> ${card.dataset.name} <span class="yellow-dot">•</span>`;
												exerciseVideo.setAttribute("src", `https://cdn.personalpeak360.de/trainingshalle/${card.dataset.video}`);

												// Textinhalte aktualisieren
												exerciseText.value = card.dataset.text

												// Zeige die Übungsdetails an
												exerciseDetails.querySelector("p").classList.add("d-none");
												exerciseInfo.classList.remove("d-none");

												// Warte, bis sowohl Video als auch Audio geladen sind
												let videoLoaded = false;

												// Funktion zum Überprüfen, ob beide Ressourcen geladen sind
												const checkIfLoaded = () => {
													if (videoLoaded) {
														loadingSpinner.classList.add("d-none");
														loadingSpinnerBackground.classList.add("d-none");
													}
												};

												// Ladeereignis für das Video
												exerciseVideo.onloadeddata = () => {
													videoLoaded = true;
													checkIfLoaded();
												};
											});
										});

										// Paginierung aktualisieren
										updatePagination();
										loadingSpinner.classList.add('d-none');
										loadingSpinnerBackground.classList.add('d-none');
									} else {
										loadingSpinner.classList.add('d-none');
										loadingSpinnerBackground.classList.add('d-none');

										const noResults = document.createElement('p');
										noResults.className = 'text-center text-muted';
										noResults.textContent = 'Keine Anfragen gefunden.';
										trainingshalle.appendChild(noResults);
									}
								})
								.catch(error => {
									console.error('Fehler bei der Suchanfrage:', error);
								});
							};

							
							
							if (searchButton) {
								searchButton.addEventListener('click', () => performSearch_TRAINER(1));
							}


							if (searchBar) {
								searchBar.addEventListener('keypress', function(event) {
									if (event.key === 'Enter') {
										performSearch_TRAINER(1);
									}
								});
							}



							
							const pillsTab = new bootstrap.Tab(document.getElementById("pills-tab"));

							// Füge den Event Listener für den Tab-Wechsel hinzu
							const tabList = document.querySelectorAll('#pills-tab a');

							tabList.forEach(tab => {
								tab.addEventListener('shown.bs.tab', function (event) {
									const activeTabId = event.target.getAttribute('id'); // ID des angeklickten Tabs
									const activeTabText = event.target.textContent; // Text des angeklickten Tabs
									console.log(`Tab gewechselt: ${activeTabText} (ID: ${activeTabId})`);

									if (activeTabText == "Videos vom Trainer") {
										performSearch_TRAINER(1)
									} else {
										performSearch(1)
									}
								});
							});
						});
					</script>


					
                    <div class="card radius-15">
                        <div class="card-body text-center">
                            <div class="row">
                                <!-- Linke Spalte (kleiner) -->
                                <div class="col-md-4 text-left">
                                    <!-- Kategorien oben -->
                                    <div class="categories">
                                        <ul class="nav nav-pills nav-fill mb-3" id="pills-tab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link active" id="pills-Meine-tab" data-bs-toggle="pill" href="#pills-Meine" role="tab" aria-controls="pills-Meine" aria-selected="false">Meine Videos</a>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link" id="pills-Trainer-tab" data-bs-toggle="pill" href="#pills-Trainer" role="tab" aria-controls="pills-Trainer" aria-selected="false">Videos vom Trainer</a>
                                            </li>
                                        </ul>
                    
                                        <div class="tab-content" id="pills-tabContent">
                                            <div class="tab-pane fade active show" id="pills-Meine" role="tabpanel" aria-labelledby="pills-Meine-tab">
                                                <!-- Suchleiste oben -->
                                                <div class="input-group search-bar mb-3" style="width: 100%;">
                                                    <input type="text" class="form-control" placeholder="Suche..." aria-label="Suche..." id="search-bar" aria-describedby="button-addon2">
                                                    <button class="btn btn-outline-secondary" type="button" id="button-suche">Suchen</button>
                                                </div>
                                                <!-- Übungen unten -->
                                            </div>
                    
                                            <div class="tab-pane fade" id="pills-Trainer" role="tabpanel" aria-labelledby="pills-Trainer-tab">
                                                <!-- Suchleiste oben -->
                                                <div class="input-group search-bar mb-3" style="width: 100%;">
                                                    <input type="text" class="form-control" placeholder="Suche..." aria-label="Suche..." id="search-bar_TRAINER" aria-describedby="button-addon2">
                                                    <button class="btn btn-outline-secondary" type="button" id="button-suche_TRAINER">Suchen</button>
                                                </div>
                                                <!-- Übungen unten -->
                                            </div>
                                        </div>
                                    </div>
                    
                                    <!-- Übungen für Trainingshalle -->
                                    <div class="trainingshalle mt-3">
                                        <div style="max-height: 340px; overflow-y: scroll;">
											<!-- HIER WERDEN DIE ANFRAGEN DYNAMISCH GEKADEN -->
                                        </div>
                                        <br>

										<!-- Ladeanimation als Overlay -->
										<div id="loading-spinner" class="loading-overlay d-none">
											<div class="spinner-wrapper">
												<div class="spinner-border text-primary" role="status"></div>
												<p class="loading-text text-white">Bitte warten...</p>
											</div>
										</div>
										<div id="loading-spinnerBackground" class="d-none mb-3">
											<!-- Hier kann eine beliebige Ladeanimation sein, z.B. ein Spinner -->
											<div class="spinner-border text-primary" role="status">
												<span class="sr-only"></span>
											</div>
										</div>

										<style>
											/* Ladeoverlay für den gesamten Bildschirm */
											.loading-overlay {
												position: fixed;
												top: 0;
												left: 0;
												width: 100%;
												height: 100%;
												background-color: rgba(0, 0, 0, 0.6); /* Halbtransparenter schwarzer Hintergrund */
												display: flex;
												justify-content: center;
												align-items: center;
												z-index: 1000; /* Über alle anderen Elemente legen */
											}

											.spinner-border {
												color: var(--primary-color) !important; /* Farbe des Spinners */
											}

											/* Wrapper für den Spinner und den Text */
											.spinner-wrapper {
												display: flex;
												flex-direction: column;
												align-items: center;
												animation: fadeIn 0.5s ease-in-out; /* Sanfte Einblendanimation */
											}

											/* Ladeanimationstext */
											.loading-text {
  												color: var(--primary-color) !important; /* Farbe des Textes */
												margin-top: 15px;
												font-size: 1.2rem;
												animation: pulse 1s infinite; /* Pulsierende Animation */
											}

											/* Animationen */
											@keyframes fadeIn {
												from {
													opacity: 0;
												}
												to {
													opacity: 1;
												}
											}

											@keyframes pulse {
												0%, 100% {
													opacity: 1;
												}
												50% {
													opacity: 0.5;
												}
											}
										</style>
										

                                        <!-- Übungen hier aufführen -->
                                        <nav aria-label="Page navigation example" class="d-flex justify-content-center align-items-center">
                                            <ul class="pagination round-pagination">
                                                <li class="page-item"><a class="page-link" href="javascript:;">Zurück</a></li>
                                                <li class="page-item"><a class="page-link" href="javascript:;">1</a></li>
                                                <li class="page-item active"><a class="page-link" href="javascript:;">2</a></li>
                                                <li class="page-item"><a class="page-link" href="javascript:;">3</a></li>
                                                <li class="page-item"><a class="page-link" href="javascript:;">Weiter</a></li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                    
                                <!-- Rechte Spalte (größer) -->
                                <div class="col-md-8 d-flex justify-content-center align-items-center">
                                    <div class="exercise-details text-center">
                                        <p>Bitte wähle eine Anfrage von links aus, um dessen Details zu sehen.</p>
                                        <!-- Details zur Übung -->
                                        <div class="exercise-info d-none">
                                            <h4>Übungsname</h4>
                                            <div class="exercise-video">
                                                <video class="w-100" controls>
                                                    <source type="video/mp4">
                                                    Dein Browser unterstützt das Video-Element nicht.
                                                </video>
                                            </div>

											<style>
												.exercise-video {
													border-radius: 40px; /* Oder ein anderer Wert */
													overflow: hidden; /* Um sicherzustellen, dass das Video nicht über die Ecken hinausragt */
												}
											</style>

											<br>

											<!-- Unbearbeitbarer Text -->
											<textarea class="exercise-textarea form-control" readonly></textarea>

											<br>
											<div id="Div-Antwort_TRAINER" style="display: none;">
												<div class="accordion" id="accordionFlushExample">
													<div class="accordion-item">
														<h2 class="accordion-header" id="flush-headingOne">
															<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
																Antwort von TRAINER
															</button>
														</h2>
														<div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample" style="">
															<div class="accordion-body">
																<div class="antwort-video">
																	<video class="w-100" controls>
																		<source type="video/mp4">
																		Dein Browser unterstützt das Video-Element nicht.
																	</video>
																</div>
					
																<style>
																	.exercise-video {
																		border-radius: 40px; /* Oder ein anderer Wert */
																		overflow: hidden; /* Um sicherzustellen, dass das Video nicht über die Ecken hinausragt */
																	}
																</style>
					
																<br>
					
																<!-- Unbearbeitbarer Text -->
																<textarea class="antwort-textarea form-control" readonly></textarea>
															</div>
														</div>
													</div>
												</div>
											</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
            <!--end page-content-wrapper-->
        </div>
        <!--end page-wrapper-->

		<!--start overlay-->
		<div class="overlay toggle-btn-mobile"></div>
		<!--end overlay-->
		<!--Start Back To Top Button--> <a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
		<!--End Back To Top Button-->
		
        {{ footer | safe }}

	</div>
	<!-- end wrapper -->
	
    {{ theme_customizer | safe }}
    
	<!-- JavaScript -->
	<!-- Bootstrap JS -->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/bootstrap.bundle.min.js"></script>
	
	<!--plugins-->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/jquery.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/simplebar/js/simplebar.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/metismenu/js/metisMenu.min.js"></script>
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flipdown/dist/flipdown.min.js"></script>
	<!--Data Tables js-->
	<script src="https://cdn.personalpeak360.de/syndash/assets/plugins/datatable/js/jquery.dataTables.min.js"></script>
	<script>
		$(document).ready(function () {
			//Default data table
			$('#example').DataTable();
			var table = $('#example2').DataTable({
				lengthChange: false,
				buttons: ['copy', 'excel', 'pdf', 'print', 'colvis']
			});
			table.buttons().container().appendTo('#example2_wrapper .col-md-6:eq(0)');
		});
	</script>
	<!-- App JS -->
	<script src="https://cdn.personalpeak360.de/syndash/assets/js/app.js"></script>

	
	<script>
		new Vue({
			el: '#app',
			data: {
				error: "{{ error }}",
				success: "{{ success }}",
				punkte: "{{ punkte_nachricht }}"
			},
			methods: {
				showMessages() {
					if (this.isErrorVisible) {
						this.showError();
					}
					if (this.isSuccessVisible) {
						this.showSuccess();
					}
					if (this.isPunkteVisible) {
						this.showPunkte();
					}
				},
				showError() {
					// Create an instance of Notyf
					var message = new nachricht({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display an error notification
					message.error('{{ error }}');
				},
				showSuccess() {
					// Create an instance of Notyf
					var message = new nachricht({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display a success notification
					message.success('{{ success }}');
				},
				showPunkte() {
					// Create an instance of Notyf
					var message = new nachricht({
						duration: 5000,
						position: {
							x: 'right',
							y: 'top',
						},
						dismissible: true
					});
	
					// Display points notification
					message.success('{{ punkte }}'); // or use message.error() if it should be an error
				}
			},
			computed: {
				isErrorVisible: function () {
					return this.error && this.error !== '' && this.error !== 'None';
				},
				isSuccessVisible: function() {
					return this.success && this.success !== '' && this.success !== 'None';
				},
				isPunkteVisible: function() {
					return this.punkte && this.punkte !== '' && this.punkte !== 'None';
				}
			},
			watch: {
				isErrorVisible(newVal) {
					if (!newVal) {
						this.closeError();
					}
				},
				isSuccessVisible(newVal) {
					if (!newVal) {
						this.closeSuccess();
					}
				},
				isPunkteVisible(newVal) {
					if (!newVal) {
						this.closePunkte(); // You can implement this method if needed
					}
				}
			},
			created() {
				this.$nextTick(() => {
					this.showMessages();
				})
			}
		});
	</script>	
</body>

</html>